!function(e){"use strict";e.fn.palleon=function(a){var t,n=e(this),l=document.body.clientWidth,i=e.extend({fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",fontSize:60,fontWeight:"normal",fontStyle:"normal",canvasColor:"transparent",fill:"#000",stroke:"#fff",strokeWidth:0,textBackgroundColor:"rgba(255,255,255,0)",textAlign:"left",lineHeight:1.2,shapeColor:"#fff",borderColor:"#000",borderDashArray:[4,4],borderOpacityWhenMoving:.5,borderScaleFactor:2,editingBorderColor:"rgba(0,0,0,0.5)",cornerColor:"#fff",cornerSize:12,cornerStrokeColor:"#000",cornerStyle:"circle",transparentCorners:!1,cursorColor:"#000",cursorWidth:2,enableGLFiltering:!0,textureSize:4096,version:"backend",watermark:"none",watermarkText:"palleon.website",watermarkFontFamily:"Georgia, serif",watermarkFontColor:"#000",watermarkFontSize:40,watermarkFontWeight:"normal",watermarkFontStyle:"normal",watermarkStrokeColor:"#FFF",watermarkLocation:"bottom-right",customFunctions:function(){}},a),o="none",r="",s="",c="",d="",p=0,f=1,g=1,m="left",h="top",u="",b=[],v="",y="",w="",k="",x=0,j="add-to-canvas",P=["circle","square","rectangle","triangle","ellipse","trapezoid","octagon","pentagon","emerald","star","printarea"],C=["square","rectangle","triangle","printarea"],I=[["Helvetica Neue","'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"],["Impact","Impact, Charcoal, sans-serif"],["Georgia","Georgia, serif"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Times New Roman","'Times New Roman', Times, serif"],["Arial","Arial, Helvetica, sans-serif"],["Arial Black","'Arial Black', Gadget, sans-serif"],["Comic Sans","'Comic Sans MS', cursive, sans-serif"],["Lucida Sans","'Lucida Sans Unicode', 'Lucida Grande', sans-serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Trebuchet","'Trebuchet MS', Helvetica, sans-serif"],["Verdana","Verdana, Geneva, sans-serif"],["Courier New","'Courier New', Courier, monospace"],["Lucida Console","'Lucida Console', Monaco, monospace"]];n.find(".crop-custom").css("display","none"),e("body").hasClass("edit_attachment")&&n.find("#palleon-new").remove();for(var S=new LazyLoad({callback_error:a=>{a.setAttribute("src",palleonParams.baseURL+"assets/placeholder.png"),e(a).parent().css("min-height","auto"),e(a).parent().find(".palleon-img-loader").remove()},callback_loaded:a=>{e(a).parent().css("min-height","auto"),e(a).parent().find(".palleon-img-loader").remove()}}),T=0;T<I.length;T++)n.find("#websafe-fonts").append(e('<option class="websafe-font"></option>').attr("value",I[T][1]).text(I[T][0]).attr("data-font",I[T][1]).text(I[T][0]));function A(e){var a=e.find(">*"),t=a.length,l=parseInt(e.data("perpage"));if(t>l){a.slice(l).hide();var i='<div id="'+e.attr("id")+'-pagination" class="palleon-pagination"></div>';e.after(i),n.find("#"+e.attr("id")+"-pagination").pagination({items:t,itemsOnPage:l,prevText:'<span class="material-icons">navigate_before</span>',nextText:'<span class="material-icons">navigate_next</span>',displayedPages:3,onPageClick:function(e,t){void 0!==t&&t.preventDefault();var n=l*(e-1),i=n+l;a.hide().slice(n,i).show()}}),n.find("#"+e.attr("id")+"-pagination").pagination("selectPage",1)}}function O(e){for(var a=e.split(","),t=a[0].match(/:(.*?);/)[1],n=atob(a[1]),l=n.length,i=new Uint8Array(l);l--;)i[l]=n.charCodeAt(l);return new Blob([i],{type:t})}function F(e,a){var t=new XMLHttpRequest;t.onload=function(){var e=new FileReader;e.onloadend=function(){a(e.result)},e.readAsDataURL(t.response)},t.open("GET",e),t.responseType="blob",t.send()}function R(){n.removeClass("panel-closed"),n.find(".palleon-icon-menu-btn").removeClass("active"),n.find("#palleon-icon-menu").removeClass("closed"),n.find("#palleon-toggle-left").removeClass("closed"),n.find("#palleon-toggle-left").find(".material-icons").html("chevron_left"),n.find("#palleon-icon-panel").show()}function q(){n.addClass("panel-closed"),n.find(".palleon-icon-menu-btn").removeClass("active"),n.find("#palleon-icon-menu").addClass("closed"),n.find("#palleon-toggle-left").addClass("closed"),n.find("#palleon-toggle-left").find(".material-icons").html("chevron_right"),n.find("#palleon-icon-panel").hide()}e.getJSON(palleonParams.baseURL+"json/google-fonts.json",function(a){for(var t=0;t<a.items.length;t++)n.find("#google-fonts").append(e('<option class="google-font"></option>').attr("value",a.items[t].family).text(a.items[t].family).attr("data-font",a.items[t].family).text(a.items[t].family))}),e.getJSON(palleonParams.baseURL+"json/material-icons.json",function(e){for(var a=palleonParams.sourceURL,t=0;t<e.categories.length;t++)for(var l=e.categories[t],i=0;i<l.icons.length;i++){var o=a+"icons/"+l.icons[i].group_id+"/"+l.icons[i].ligature;n.find("#palleon-icons .palleon-grid").append('<div class="palleon-element add-element" data-elsource="'+o+'" data-loader="no" title="'+l.icons[i].name+'"><span class="material-icons">'+l.icons[i].ligature+"</div>")}}),n.find(".palleon-select.palleon-select2").select2({theme:"dark",width:"100%",templateSelection:de,templateResult:de,allowHtml:!0}),n.find(".palleon-colorpicker.disallow-empty").spectrum({allowEmpty:!1,showInitial:!0,showAlpha:"true"===palleonParams.alphaColor}),n.find(".palleon-colorpicker.allow-empty").spectrum({allowEmpty:!0,showInitial:!1,showAlpha:"true"===palleonParams.alphaColor}),toastr.options.closeButton=!0,toastr.options.positionClass="toast-bottom-left",toastr.options.progressBar=!0,toastr.options.newestOnTop=!0,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear",n.find("#palleon-canvas-wrap").draggable({disabled:!0}),n.find(".paginated").each(function(){A(e(this))}),n.find("#palleon-toggle-left").on("click",function(){e(this).hasClass("closed")?R():q()}),n.find("#palleon-toggle-right").on("click",function(){e(this).hasClass("closed")?(n.removeClass("layers-closed"),e(this).removeClass("closed"),e(this).find(".material-icons").html("chevron_right"),n.find("#palleon-right-col").show()):(n.addClass("layers-closed"),e(this).addClass("closed"),e(this).find(".material-icons").html("chevron_left"),n.find("#palleon-right-col").hide())}),n.find(".palleon-toggle-right").on("click",function(e){e.preventDefault(),n.find("#palleon-toggle-right").trigger("click")}),l<=1200&&(n.find("#palleon-toggle-right").trigger("click"),n.find("#palleon-toggle-left").trigger("click")),n.find(".palleon-icon-menu-btn").on("click",function(){e(this).data("target")&&(e(this).hasClass("active")?q():(R(),e(this).addClass("active"),n.find(".palleon-icon-panel-content").addClass("panel-hide"),n.find(e(this).data("target")).removeClass("panel-hide"))),"palleon-btn-elements"==e(this).attr("id")&&n.find("#palleon-all-elements-open").trigger("click")}),n.find(".palleon-dropdown-wrap").on("click",function(){e(this).hasClass("opened")?(e(this).removeClass("opened"),e(this).find(".palleon-dropdown").hide()):(e(this).addClass("opened"),e(this).find(".palleon-dropdown").show())}),n.find(".palleon-icon-panel-content ul.palleon-accordion > li > a").on("click",function(a){a.preventDefault();var t=e(this).parent().parent();e(this).parent().hasClass("opened")?t.find("li").removeClass("opened"):(t.find("li").removeClass("opened"),e(this).parent().addClass("opened"))}),n.find(".palleon-lock-unlock").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),e(this).find(".material-icons").html("lock_open")):(e(this).addClass("active"),e(this).find(".material-icons").html("lock"))}),n.find(".palleon-slider").on("input",function(){e(this).parent().parent().find(".slider-label span").html(e(this).val()),n.find("span.tm-count-zoom").html(e(this).val())}),n.find('input[type="checkbox"]').on("change",function(){e(this).data("conditional")&&(e(this).is(":checked")?n.find(e(this).data("conditional")).removeClass("d-none"):n.find(e(this).data("conditional")).addClass("d-none"))}),n.find(".palleon-tabs-menu li").on("click",function(){var a=e(this).data("target"),t=e(this).parent().parent();t.find("> .palleon-tab").removeClass("active"),e(a).addClass("active"),t.find("> .palleon-tabs-menu li").removeClass("active"),e(this).addClass("active")}),n.find('input[type="number"]:not(.disable-val),.numeric-field').bind("input paste keyup keydown",function(){this.value=this.value.replace(/(?!^-)[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),e(this).data("max")&&this.value>e(this).data("max")&&(this.value=e(this).data("max")),e(this).data("min")&&this.value<e(this).data("min")&&(this.value=e(this).data("min"))}),n.find(".palleon-counter .counter-plus").on("click",function(){var a=e(this).parent().find("input.palleon-form-field"),t=parseInt(a.val())+parseInt(a.data("step"));a.data("max")&&t>a.data("max")&&(t=a.data("max")),a.data("min")&&t<a.data("min")&&(t=a.data("min")),t<0&&(t=0),a.val(t),"palleon-img-zoom-in"==e(this).attr("id")&&ae(t)}),n.find(".palleon-counter .counter-minus").on("click",function(){var a=e(this).parent().find("input.palleon-form-field"),t=parseInt(a.val())-parseInt(a.data("step"));a.data("max")&&t>a.data("max")&&(t=a.data("max")),a.data("min")&&t<a.data("min")&&(t=a.data("min")),t<0&&(t=0),a.val(t),"palleon-img-zoom-out"==e(this).attr("id")&&ae(t)}),fabric.enableGLFiltering=i.enableGLFiltering,fabric.textureSize=parseInt(i.textureSize),fabric.Object.prototype.borderColor=i.borderColor,fabric.Object.prototype.borderDashArray=i.borderDashArray,fabric.Object.prototype.borderOpacityWhenMoving=i.borderOpacityWhenMoving,fabric.Object.prototype.borderScaleFactor=i.borderScaleFactor,fabric.Object.prototype.editingBorderColor=i.editingBorderColor,fabric.Object.prototype.cornerColor=i.cornerColor,fabric.Object.prototype.cornerSize=i.cornerSize,fabric.Object.prototype.cornerStrokeColor=i.cornerStrokeColor,fabric.Object.prototype.cornerStyle=i.cornerStyle,fabric.Object.prototype.transparentCorners=i.transparentCorners,fabric.Object.prototype.cursorColor=i.cursorColor,fabric.Object.prototype.cursorWidth=i.cursorWidth,fabric.Object.prototype.strokeUniform=!0,fabric.Group.prototype.padding=0,fabric.Object.prototype.erasable=!1;var X=document.createElement("img");function Y(a,t){var l=t.target;"activeSelection"===l.type?(e.each(l._objects,function(e,a){n.find("#palleon-layers #"+a.id).find("a.delete-layer").trigger("click")}),u.discardActiveObject()):n.find("#palleon-layers #"+l.id).find("a.delete-layer").trigger("click")}function z(e,a,t,n,l){e.save(),e.translate(a,t),e.rotate(fabric.util.degreesToRadians(l.angle)),e.drawImage(X,-12,-12,24,24),e.restore()}X.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_delete_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='120.001' y='239.987' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='271.997' height='32'/%3E%3Crect x='240' y='119.989' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='32' height='271.997'/%3E%3C/g%3E%3C/svg%3E";var W=document.createElement("img");function D(e,a){var t=a.target;"activeSelection"===t.type?toastr.warning(palleonParams.noDuplicate,palleonParams.warning):n.find("#palleon-layers #"+t.id).find("a.duplicate-layer").trigger("click")}function E(e,a,t,n,l){e.save(),e.translate(a,t),e.rotate(fabric.util.degreesToRadians(l.angle)),e.drawImage(W,-12,-12,24,24),e.restore()}function B(e,a){""==e&&(e=(new Date).getTime()),""==a?a="png":"jpg"==a&&(a="jpeg"),n.find(".palleon-file-name").val(e),n.find(".palleon-file-name").data("default",e),n.find("#palleon-save-img-format").val(a),n.find("#palleon-save-img-format").trigger("change"),n.find("#palleon-download-format").val(a),n.find("#palleon-download-format").trigger("change")}function M(e){if(p=0,n.find("#palleon-canvas-loader").css("display","flex"),n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),o=e,u.backgroundImage&&(b=u.backgroundImage.filters),"canvas"==o){n.find("#palleon-canvas-color").trigger("change");var a=document.createElement("canvas"),t=new fabric.Canvas(a),l=parseInt(n.find("#palleon-canvas-width").val()),i=parseInt(n.find("#palleon-canvas-height").val());""==l&&(l=800),""==i&&(i=800),t.setWidth(l),t.setHeight(i),t.backgroundColor="transparent";var v=O(t.toDataURL({format:"png",enableRetinaScaling:!1})),y=URL.createObjectURL(v);n.find("#palleon-canvas-img").attr("src",y),t.dispose()}n.find("#palleon-canvas-img-wrap").imagesLoaded(function(){r=n.find("#palleon-canvas-img")[0],s=n.find("#palleon-canvas-img").attr("src"),c=r.width,d=r.height,te(r),u.setDimensions({width:c,height:d}),fabric.Image.fromURL(s,function(e){u.setBackgroundImage(e,u.renderAll.bind(u),{objectType:"BG",mode:o,scaleX:f,scaleY:g,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"}),setTimeout(function(){n.find("#palleon-canvas-loader").hide()},500)}),ae(),L(),setTimeout(function(){!function(){p=0,f=1,g=1,m="left",h="top",void 0!==u.overlayImage&&null!==u.overlayImage&&(u.overlayImage=null);if(n.find("#keep-data").is(":checked"))u.backgroundImage.filters=b,u.backgroundImage.applyFilters();else{u.backgroundImage.filters=[],n.find("#palleon-adjust .conditional-settings").addClass("d-none"),n.find("#palleon-brightness").prop("checked",!1),n.find("#brightness").val(0),n.find("#palleon-contrast").prop("checked",!1),n.find("#contrast").val(0),n.find("#palleon-saturation").prop("checked",!1),n.find("#saturation").val(0),n.find("#palleon-hue").prop("checked",!1),n.find("#hue").val(0),n.find("#palleon-filters input[type=checkbox]").prop("checked",!1),n.find("#palleon-gamma").prop("checked",!1),n.find("#gamma-red").val(1),n.find("#gamma-green").val(1),n.find("#gamma-blue").val(1),n.find("#palleon-blend-color").prop("checked",!1),n.find("#blend-color-mode").val("add"),n.find("#blend-color-color").spectrum("set","#ffffff"),n.find("#blend-color-alpha").val(.5),n.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),n.find("#palleon-duotone-color").prop("checked",!1),n.find("#duotone-light-color").spectrum("set","green"),n.find("#duotone-dark-color").spectrum("set","blue"),n.find("#palleon-swap-colors").prop("checked",!1),n.find("#palleon-blur").prop("checked",!1),n.find("#blur").val(0),n.find("#palleon-noise").prop("checked",!1),n.find("#noise").val(0),n.find("#palleon-pixelate").prop("checked",!1),n.find("#pixelate").val(1);var e=u.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers li").remove(),K()}u.fire("selection:cleared"),u.requestRenderAll()}(),Z('<span class="material-icons">flag</span>'+palleonParams.started)},500)})}(W.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_add_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23009688;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='240' y='120' style='fill:%23FFFFFF;' width='32' height='272'/%3E%3Crect x='120' y='240' style='fill:%23FFFFFF;' width='272' height='32'/%3E%3C/g%3E%3C/svg%3E",fabric.Image.filters.Shift=fabric.util.createClass(fabric.Image.filters.ColorMatrix,{type:"Shift",matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],mainParameter:!1,colorsOnly:!0}),t=n.find("#palleon-canvas")[0],(u=new fabric.Canvas(t)).backgroundColor=i.canvasColor,""!=n.find("#palleon-canvas-img").attr("src"))&&(o="image",B(n.find("#palleon-canvas-img").data("filename"),n.find("#palleon-canvas-img").attr("src").match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),M(o));if(L(),""!=n.find("#palleon-canvas-img").data("template")){n.find("#palleon-canvas-loader").css("display","flex"),n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),n.find(".palleon-modal").hide();var G=u.getObjects();G.filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers li").remove(),K(),e.getJSON(n.find("#palleon-canvas-img").data("template"),function(e){H(e),setTimeout(function(){Z('<span class="material-icons">flag</span>'+palleonParams.started)},500)}).fail(function(e,a,t){toastr.error("Request Failed: "+t,palleonParams.error)}).always(function(){n.find("#palleon-canvas-loader").hide()})}function L(){"none"==o?(n.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","none"),n.find(".palleon-keep, #modal-add-new .palleon-modal-close").hide(),n.find("#modal-add-new").show(),n.find("#palleon-save").prop("disabled",!0)):(n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),n.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","auto"),n.find(".palleon-keep, #modal-add-new .palleon-modal-close").show(),n.find("#modal-add-new").hide(),n.find("#palleon-save").prop("disabled",!1)),"canvas"==o?n.find(".hide-on-canvas-mode").hide():n.find(".hide-on-canvas-mode").show()}function H(a){n.find("#palleon-canvas-loader").css("display","flex"),p=a.backgroundImage.angle,f=a.backgroundImage.scaleX,g=a.backgroundImage.scaleY,m=a.backgroundImage.originX,h=a.backgroundImage.originY,u.clear(),n.find("#palleon-layers li").remove(),o=a.backgroundImage.mode;var t=O(a.backgroundImage.src);s=URL.createObjectURL(t),n.find("#palleon-canvas-img").attr("src",s),c=a.backgroundImage.width,d=a.backgroundImage.height;for(var l={width:c,height:d},i=0;i<a.objects.length;i++)"textbox"==a.objects[i].objectType&&(a.objects[i].fontFamily=a.objects[i].fontFamily+"-palleon",a.objects[i].realFontSize=a.objects[i].fontSize,a.objects[i].fontSize=1);u.loadFromJSON(a,function(){U(u.getObjects().filter(e=>"textbox"==e.objectType)),K(),n.find("#palleon-canvas-color").spectrum("set",u.backgroundColor),n.find("#custom-image-background").spectrum("set",u.backgroundColor),r=n.find("#palleon-canvas-img")[0],u.requestRenderAll(),n.find("#palleon-canvas-loader").hide(),u.fire("palleon:templateLoaded")},function(){},{crossOrigin:"anonymous"}),B((new Date).getTime(),""),te(l),ae(),L(),u.fire("selection:cleared"),setTimeout(function(){var t;n.find("#palleon-layers > li").removeClass("active"),a.backgroundImage&&(t=a.backgroundImage.filters,n.find("#palleon-brightness").prop("checked",!1),n.find("#palleon-contrast").prop("checked",!1),n.find("#palleon-saturation").prop("checked",!1),n.find("#palleon-hue").prop("checked",!1),n.find("#grayscale").prop("checked",!1),n.find("#sepia").prop("checked",!1),n.find("#brownie").prop("checked",!1),n.find("#blackwhite").prop("checked",!1),n.find("#vintage").prop("checked",!1),n.find("#kodachrome").prop("checked",!1),n.find("#polaroid").prop("checked",!1),n.find("#technicolor").prop("checked",!1),n.find("#invert").prop("checked",!1),n.find("#sharpen").prop("checked",!1),n.find("#emboss").prop("checked",!1),n.find("#palleon-gamma").prop("checked",!1),n.find("#palleon-blend-color").prop("checked",!1),n.find("#palleon-duotone-color").prop("checked",!1),n.find("#palleon-blur").prop("checked",!1),n.find("#palleon-noise").prop("checked",!1),n.find("#palleon-pixelate").prop("checked",!1),0!==t.length&&e.each(t,function(e,a){"Brightness"==a.type?(n.find("#palleon-brightness").prop("checked",!0),n.find("#brightness").val(a.brightness),n.find("#brightness").parent().parent().find(".slider-label span").html(a.brightness)):"Contrast"==a.type?(n.find("#palleon-contrast").prop("checked",!0),n.find("#contrast").val(a.brightness),n.find("#contrast").parent().parent().find(".slider-label span").html(a.contrast)):"Saturation"==a.type?(n.find("#palleon-saturation").prop("checked",!0),n.find("#saturation").val(a.brightness),n.find("#saturation").parent().parent().find(".slider-label span").html(a.saturation)):"HueRotation"==a.type?(n.find("#palleon-hue").prop("checked",!0),n.find("#hue").val(a.rotation),n.find("#hue").parent().parent().find(".slider-label span").html(a.rotation)):"Grayscale"==a.type?n.find("#grayscale").prop("checked",!0):"Sepia"==a.type?n.find("#sepia").prop("checked",!0):"Brownie"==a.type?n.find("#brownie").prop("checked",!0):"BlackWhite"==a.type?n.find("#blackwhite").prop("checked",!0):"Vintage"==a.type?n.find("#vintage").prop("checked",!0):"Kodachrome"==a.type?n.find("#kodachrome").prop("checked",!0):"Polaroid"==a.type?n.find("#polaroid").prop("checked",!0):"Technicolor"==a.type?n.find("#technicolor").prop("checked",!0):"Invert"==a.type?n.find("#invert").prop("checked",!0):"Convolute"==a.type?"[0,-1,0,-1,5,-1,0,-1,0]"==a.matrix?n.find("#sharpen").prop("checked",!0):"[1,1,1,1,0.7,-1,-1,-1,-1]"==a.matrix?n.find("#emboss").prop("checked",!0):"[-1,0,1,-2,0,2,-1,0,1]"==a.matrix?n.find("#sobelX").prop("checked",!0):"[-1,-2,-1,0,0,0,1,2,1]"==a.matrix&&n.find("#sobelY").prop("checked",!0):"Gamma"==a.type?(n.find("#palleon-gamma").prop("checked",!0),n.find("#gamma-red").val(a.gamma[0]),n.find("#gamma-red").parent().parent().find(".slider-label span").html(a.gamma[0]),n.find("#gamma-green").val(a.gamma[1]),n.find("#gamma-green").parent().parent().find(".slider-label span").html(a.gamma[1]),n.find("#gamma-blue").val(a.gamma[2]),n.find("#gamma-blue").parent().parent().find(".slider-label span").html(a.gamma[2])):"BlendColor"==a.type?(n.find("#palleon-blend-color").prop("checked",!0),n.find("#blend-color-mode").val(a.mode),n.find("#blend-color-color").val(a.color),n.find("#blend-color-alpha").val(a.alpha),n.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(a.alpha)):"Composed"==a.type?(n.find("#palleon-duotone-color").prop("checked",!0),n.find("#duotone-light-color").val(a.subFilters[1].color),n.find("#duotone-dark-color").val(a.subFilters[2].color)):"Blur"==a.type?(n.find("#palleon-blur").prop("checked",!0),n.find("#blur").val(a.blur),n.find("#blur").parent().parent().find(".slider-label span").html(a.blur)):"Noise"==a.type?(n.find("#palleon-noise").prop("checked",!0),n.find("#noise").val(a.noise),n.find("#noise").parent().parent().find(".slider-label span").html(a.noise)):"Pixelate"==a.type&&(n.find("#palleon-pixelate").prop("checked",!0),n.find("#pixelate").val(a.blocksize),n.find("#pixelate").parent().parent().find(".slider-label span").html(a.blocksize))}),n.find("#palleon-brightness").trigger("change"),n.find("#palleon-contrast").trigger("change"),n.find("#palleon-saturation").trigger("change"),n.find("#palleon-hue").trigger("change"),n.find("#palleon-gamma").trigger("change"),n.find("#palleon-blend-color").trigger("change"),n.find("#palleon-blur").trigger("change"),n.find("#palleon-noise").trigger("change"),n.find("#palleon-pixelate").trigger("change")),a.overlayImage?(n.find("#palleon-overlay-wrap").show(),n.find("#palleon-overlay-preview").attr("src",a.overlayImage.src)):(n.find("#palleon-overlay-wrap").hide(),n.find("#palleon-overlay-preview").attr("src",""))},100)}function U(a){0!==a.length&&e.each(a,function(e,a){var t=a.fontFamily.replace("-palleon","");a.fontFamily=i.fontFamily;var n="yes";if(""==t)n="no";else for(var l=0;l<I.length;l++)if(I[l][1]==t){n="no";break}if("yes"==n){"undefined"==typeof palleonCustomFonts?WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}}):palleonCustomFonts.fonts.includes(t)||WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}});var o=new FontFaceObserver(t,{weight:"normal",style:"normal"}),r=new FontFaceObserver(t,{weight:"bold",style:"normal"}),s=new FontFaceObserver(t,{weight:"normal",style:"italic"}),c=new FontFaceObserver(t,{weight:"bold",style:"italic"});Promise.all([o.load(null,5e3),r.load(null,5e3),s.load(null,5e3),c.load(null,5e3)]).then(function(){a.set("fontFamily",t),a.set("fontSize",a.realFontSize),u.requestRenderAll()}).catch(function(e){console.log(e)})}else a.set("fontFamily",t),a.set("fontSize",a.realFontSize),u.requestRenderAll()})}function _(){if("frontend"==palleonParams.watermark||"both"==palleonParams.watermark){if("frontend"==palleonParams.watermark&&"backend"==palleonParams.version)return;var e=i.watermarkLocation,a=c*i.watermarkFontSize/1400,t=new fabric.Textbox(" "+palleonParams.watermarkText+" ",{objectType:"watermark",gradientFill:"none",fontSize:a,fontFamily:i.watermarkFontFamily,fontWeight:i.watermarkFontWeight,fontStyle:i.watermarkFontStyle,lineHeight:1,fill:i.watermarkFontColor,textBackgroundColor:i.watermarkStrokeColor,width:re()[0],left:0});u.add(t),"bottom-right"==e?(t.textAlign="right",t.top=re()[1]-t.height):"bottom-left"==e?(t.textAlign="left",t.top=re()[1]-t.height):"top-right"==e?(t.textAlign="right",t.top=0):"top-left"==e&&(t.textAlign="left",t.top=0),t.moveTo(999)}}function N(){if("frontend"==palleonParams.watermark||"both"==palleonParams.watermark){if("frontend"==palleonParams.watermark&&"backend"==palleonParams.version)return;(G=u.getObjects()).filter(e=>"watermark"===e.objectType).forEach(e=>u.remove(e))}}function V(e){var a=palleonParams.object,t="category";return null==e?(a=palleonParams.object,t="category"):"textbox"==e?(a=palleonParams.text,t="title"):"drawing"==e?(a=palleonParams.freeDrawing,t="brush"):"frame"==e?(a=palleonParams.frame,t="wallpaper"):"image"==e?(a=palleonParams.image,t="image"):"circle"==e?a=palleonParams.circle:"square"==e?a=palleonParams.square:"rectangle"==e?a=palleonParams.rectangle:"triangle"==e?a=palleonParams.triangle:"ellipse"==e?a=palleonParams.ellipse:"trapezoid"==e?a=palleonParams.trapezoid:"pentagon"==e?a=palleonParams.pentagon:"octagon"==e?a=palleonParams.octagon:"emerald"==e?a=palleonParams.emerald:"star"==e?a=palleonParams.star:"element"==e?(a=palleonParams.element,t="star"):"BG"==e?(a=palleonParams.bg,t="image"):"customSVG"==e?a=palleonParams.customSvg:"qrCode"==e&&(a=palleonParams.qrCode,t="qr_code"),'<span class="material-icons">'+t+"</span>"+a}function Z(e){var a=n.find("#palleon-history-list"),t=new Date,l=String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0"),i=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);n.find("#palleon-history").prop("disabled",!1),a.find("li").removeClass("active"),a.prepend('<li class="active"><div class="info">'+e+'<span class="time">'+l+'</span></div><div><button type="button" class="palleon-btn primary"><span class="material-icons">restore</span>Restore</button><button type="button" class="palleon-btn danger"><span class="material-icons">clear</span>Delete</button><script type="text/json">'+JSON.stringify(i)+"<\/script></div></li>"),a.find("li").length>a.data("max")&&a.find("li").last().remove(),n.find("#palleon-history-count").html(a.find("li").length);var o=a.find("li.active").next("li"),r=a.find("li.active").prev("li");o.length?n.find("#palleon-undo").prop("disabled",!1):n.find("#palleon-undo").prop("disabled",!0),r.length?n.find("#palleon-redo").prop("disabled",!1):n.find("#palleon-redo").prop("disabled",!0)}n.find(".palleon-modal-open").on("click",function(a){a.preventDefault();var t=e(this).data("target");n.find(".palleon-modal").hide(),n.find(t).show()}),n.find(".palleon-modal-close").on("click",function(a){a.preventDefault();var t=e(this).data("target");n.find(t).hide()}),n.find("#palleon-image-upload").on("change",function(){if(""!=e(this).val()){n.find(".palleon-modal").hide(),n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible");var a=new FileReader;a.onload=function(e){n.find("#palleon-canvas-img").attr("src",a.result),M("image")},a.readAsDataURL(this.files[0]),B(this.files[0].name.replace(/\.[^/.]+$/,""),this.files[0].name.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""))}}),n.find("#palleon-canvas-create").on("click",function(){B((new Date).getTime(),""),M("canvas")}),n.find("#palleon-template-search").on("click",function(){e(this);var a=n.find("#palleon-template-search-keyword").val(),t=n.find("#palleon-templates-menu").val(),l={action:"templateSearch",nonce:palleonParams.nonce,keyword:a,category:t};e.ajax({url:palleonParams.ajaxurl,data:l,type:"POST",success:function(e){e&&(n.find("#palleon-templates-grid-pagination").remove(),n.find("#palleon-templates-grid").html(e),S.update(),A(n.find("#palleon-templates-grid")))},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find(".template-grid").on("click",".template-favorite button.star",function(){var a=e(this),t=a.data("templateid"),l="add";a.hasClass("favorited")?(n.find('*[data-templateid="'+t+'"]').removeClass("favorited"),l="remove"):n.find('*[data-templateid="'+t+'"]').addClass("favorited");var i={action:"favTemplate",nonce:palleonParams.nonce,templateid:t,mode:l};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==l?(toastr.success(palleonParams.favorited,palleonParams.success),n.find('*[data-templateid="'+t+'"]').html('<span class="material-icons">star</span>')):(toastr.success(palleonParams.unfavorited,palleonParams.success),n.find('*[data-templateid="'+t+'"]').html('<span class="material-icons">star_border</span>')),e&&(n.find("#palleon-templates-favorites-grid-pagination").remove(),n.find("#palleon-templates-favorites-grid").html(e),S.update(),A(n.find("#palleon-templates-favorites-grid")))},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-json-download").on("click",function(){var e=n.find("#palleon-json-download-name").val(),a=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);F(a.backgroundImage.src,function(t){a.backgroundImage.src=t;var l=JSON.stringify(a),i=document.createElement("a"),o=new Blob([l],{type:"text/plain"});i.href=URL.createObjectURL(o),i.download=e+".json",i.click(),n.find(".palleon-modal").hide()})}),e(document).on("loadTemplate",function(a,t,l,i){if(u.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers li").remove(),K(),t){var o=JSON.parse(t);F(o.backgroundImage.src,function(e){o.backgroundImage.src=e,H(o),""!=i&&(u.backgroundColor=i),setTimeout(function(){n.find("#palleon-canvas-loader").hide()},500)})}else e.getJSON(l,function(e){H(e),""!=i&&(u.backgroundColor=i)}).fail(function(e,a,t){toastr.error("Request Failed: "+t,palleonParams.error)}).always(function(){setTimeout(function(){n.find("#palleon-canvas-loader").hide()},500)})}),e(document).on("loadTemplateFonts",function(e,a){0!==a.length&&U(a)}),n.find("#palleon-json-upload").on("change",function(e){n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),n.find("#palleon-canvas-loader").css("display","flex");var a=new FileReader;a.onload=function(e){H(JSON.parse(a.result)),n.find("#palleon-canvas-loader").hide(),setTimeout(function(){Z('<span class="material-icons">flag</span>'+palleonParams.started)},500)},a.readAsText(e.target.files[0]),n.find(".palleon-modal").hide()}),n.find(".template-selection").on("click",".palleon-select-template",function(){var a=e(this).attr("data-version");if("frontend"==palleonParams.version&&"pro"==a)toastr.warning(palleonParams.proInfo,"Login Required");else if("backend"==palleonParams.version&&"pro"==a&&"yes"!=palleonParams.proCheck)toastr.warning(palleonParams.upgradeInfo,"Premium Content");else{n.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),n.find(".palleon-modal").hide(),n.find("#palleon-canvas-loader").css("display","flex"),u.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers li").remove(),K(),e.getJSON(e(this).data("json"),function(e){H(e),setTimeout(function(){Z('<span class="material-icons">flag</span>'+palleonParams.started)},500)}).fail(function(e,a,t){toastr.error("Request Failed: "+t,palleonParams.error)}).always(function(){n.find("#palleon-canvas-loader").hide()})}}),n.find(".palleon-template-list").on("click",".palleon-template-delete",function(){if(window.confirm(palleonParams.answer1)){var a=e(this).data("target"),t=new FormData;t.append("target",a),t.append("action","deleteJsonFromLibrary"),t.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){n.find("#palleon-my-templates-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),n.find("#palleon-my-templates-refresh").on("click",function(){var a=e(this),t={action:"loadmytemplates",nonce:palleonParams.nonce,query:templatesMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(n.find("#palleon-my-templates-pagination").remove(),n.find("#palleon-my-templates").html(e),S.update(),A(n.find("#palleon-my-templates")))},error:function(e,t,n){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-my-templates-search").on("click",function(){var a=e(this).parent().find("input");if(n.find("#palleon-my-templates-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),n.find("#palleon-my-templates li").show(),n.find("#palleon-my-templates-pagination").length&&(n.find("#palleon-my-templates-pagination").pagination("redraw"),n.find("#palleon-my-templates-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var t=a.val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(n.find("#palleon-my-templates li").show(),n.find("#palleon-my-templates-pagination").length&&(n.find("#palleon-my-templates-pagination").pagination("redraw"),n.find("#palleon-my-templates-pagination").pagination("selectPage",1))):(n.find("#palleon-my-templates-pagination").length&&n.find("#palleon-my-templates-pagination").pagination("destroy"),n.find("#palleon-my-templates li").hide().filter('[data-keyword*="'+t+'"]').show(),0===n.find("#palleon-my-templates li:visible").length&&n.find("#palleon-my-templates-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),n.find("#palleon-download").on("click",function(){var a=n.find("#palleon-download-name").val(),t=parseFloat(n.find("#palleon-download-quality").val()),l=n.find("#palleon-download-format").val(),i=document.createElement("a"),o="";_(),u.setZoom(1),n.find("#palleon-img-zoom").val(100);var r=d,s=c;0!=p&&180!=p&&-180!=p||(r=c,s=d),u.setWidth(r),u.setHeight(s);var f="";if("svg"==l){var g=u.toSVG({suppressPreamble:!1,width:c,height:d}),m=u.getObjects().filter(e=>"textbox"==e.objectType),h='<defs><style type="text/css"><![CDATA[',b=[];e.each(m,function(e,a){for(var t=a.fontFamily,n="yes",l=0;l<I.length;l++)if(I[l][1]==t){n="no";break}"yes"==n&&("undefined"==typeof palleonCustomFonts?b.includes(t)||b.push(t):palleonCustomFonts.fonts.includes(t)||b.includes(t)||b.push(t))}),b.length>0?e.each(b,function(t,n){var r=t==b.length-1,s=n.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+s+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(e){h+=e,setTimeout(function(){r&&(g=g.replace("<defs>",h+"]]></style>"),f=new Blob([g],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(f),i.download=a+"."+l,i.href=o,i.click())},500)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}):(f=new Blob([g],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(f),i.download=a+"."+l,i.href=o,i.click())}else{var v=u.toDataURL({format:l,quality:t,enableRetinaScaling:!1});"webp"!=l&&(v=changeDpiDataUrl(v,n.find("#palleon-download-img-dpi").val())),f=O(v),o=URL.createObjectURL(f),i.download=a+"."+l,i.href=o,i.click()}N(),ae(),u.requestRenderAll(),n.find(".palleon-modal").hide()}),n.find("#palleon-download-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?n.find("#palleon-download-quality").prop("disabled",!0):n.find("#palleon-download-quality").prop("disabled",!1)}),n.find("#palleon-save-img-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?n.find("#palleon-save-img-quality").prop("disabled",!0):n.find("#palleon-save-img-quality").prop("disabled",!1)}),n.find("#palleon-save-img").on("click",function(){var a=(new Date).getTime(),t=n.find("#palleon-save-img-name").val(),l=parseFloat(n.find("#palleon-save-img-quality").val()),i=n.find("#palleon-save-img-format").val(),o=n.find("#palleon-canvas-img").data("id");_(),u.setZoom(1),n.find("#palleon-img-zoom").val(100);var r=d,s=c;0!=p&&180!=p&&-180!=p||(r=c,s=d),u.setWidth(r),u.setHeight(s);var f="",g="",m=new FormData;if("svg"==i){g=u.toSVG({suppressPreamble:!1,width:c,height:d});var h=u.getObjects().filter(e=>"textbox"==e.objectType),b='<defs><style type="text/css"><![CDATA[',v=[];e.each(h,function(e,a){for(var t=a.fontFamily,n="yes",l=0;l<I.length;l++)if(I[l][1]==t){n="no";break}"yes"==n&&("undefined"==typeof palleonCustomFonts?v.includes(t)||v.push(t):palleonCustomFonts.fonts.includes(t)||v.includes(t)||v.push(t))}),v.length>0?e.each(v,function(l,r){var s=l==v.length-1,c=r.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+c+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(l){b+=l,setTimeout(function(){s&&(g=g.replace("<defs>",b+"]]></style>"),f=new Blob([g],{type:"image/svg+xml;charset=utf-8"}),m.append("id",o),m.append("mode","image"),m.append("name",t),m.append("filename",a),m.append("format",i),m.append("type",f.type),m.append("url",g),m.append("action","saveImage"),m.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:m,success:function(){toastr.success(palleonParams.imgsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}))},500)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}):(f=new Blob([g],{type:"image/svg+xml;charset=utf-8"}),m.append("id",o),m.append("mode","image"),m.append("name",t),m.append("filename",a),m.append("format",i),m.append("type",f.type),m.append("url",g),m.append("action","saveImage"),m.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:m,success:function(){toastr.success(palleonParams.imgsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}))}else g=u.toDataURL({format:i,quality:l,enableRetinaScaling:!1}),"webp"!=i&&(g=changeDpiDataUrl(g,n.find("#palleon-download-img-dpi").val())),f=O(g),m.append("id",o),m.append("mode","image"),m.append("name",t),m.append("filename",a),m.append("format",i),m.append("type",f.type),m.append("url",g),m.append("action","saveImage"),m.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:m,success:function(){toastr.success(palleonParams.imgsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}});N(),ae(),u.requestRenderAll()}),n.find("#palleon-json-save").on("click",function(){var a=(new Date).getTime(),t=n.find("#palleon-json-save-name").val(),l=n.find("#palleon-canvas-img").data("id"),i=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);F(i.backgroundImage.src,function(o){i.backgroundImage.src=o;var r=JSON.stringify(i),s=new FormData;s.append("id",l),s.append("mode","json"),s.append("name",t),s.append("filename",a),s.append("json",r),s.append("action","saveJson"),s.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:s,success:function(){n.find("#palleon-my-templates-refresh").trigger("click"),toastr.success(palleonParams.tempsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})})}),n.find("#palleon-petemplate-save").on("click",function(){var a=(new Date).getTime(),t=n.find("#palleon-petemplate-save-name").val(),l=n.find("#palleon-petemplate-save-tag").val(),i=n.find("#palleon-petemplate-save-version").find(":selected").val();l=JSON.stringify(l);var o=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);o=JSON.stringify(o);var r=u.toDataURL({format:"png",quality:"1.0",enableRetinaScaling:!1}),s=O(r),c=new FormData;c.append("name",t),c.append("tag",l),c.append("version",i),c.append("filename",a),c.append("json",o),c.append("thumb",r),c.append("type",s.type),c.append("action","savePEtemplate"),c.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:c,success:function(){toastr.success(palleonParams.tempsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-agtemplate-save").on("click",function(){var a=(new Date).getTime(),t=n.find("#palleon-agtemplate-save-name").val(),l=n.find("#palleon-agtemplate-save-tag").val();l=JSON.stringify(l);var i=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin","layerName"]);i=JSON.stringify(i);var o=u.toDataURL({format:"png",quality:"1.0",enableRetinaScaling:!1}),r=O(o),s=new FormData;s.append("name",t),s.append("tag",l),s.append("filename",a),s.append("json",i),s.append("thumb",o),s.append("type",r.type),s.append("action","saveAGtemplate"),s.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:s,success:function(){toastr.success(palleonParams.tempsaved,palleonParams.success),n.find(".palleon-modal").hide()},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-canvas-size-select").on("change",function(){var a=e(this).val();"custom"==a?(n.find("#palleon-canvas-width").prop("disabled",!1),n.find("#palleon-canvas-height").prop("disabled",!1)):(n.find("#palleon-canvas-width").prop("disabled",!0),n.find("#palleon-canvas-height").prop("disabled",!0)),"blog-banner"==a?(n.find("#palleon-canvas-width").val(2240),n.find("#palleon-canvas-height").val(1260)):"fb-cover"==a?(n.find("#palleon-canvas-width").val(851),n.find("#palleon-canvas-height").val(315)):"fb-ad"==a?(n.find("#palleon-canvas-width").val(1200),n.find("#palleon-canvas-height").val(628)):"instagram"==a?(n.find("#palleon-canvas-width").val(1080),n.find("#palleon-canvas-height").val(1080)):"pinterest"==a?(n.find("#palleon-canvas-width").val(750),n.find("#palleon-canvas-height").val(1120)):"fb-post"==a?(n.find("#palleon-canvas-width").val(940),n.find("#palleon-canvas-height").val(788)):"twitter-post"==a?(n.find("#palleon-canvas-width").val(1600),n.find("#palleon-canvas-height").val(900)):"youtube"==a?(n.find("#palleon-canvas-width").val(1280),n.find("#palleon-canvas-height").val(720)):"wallpaper"==a&&(n.find("#palleon-canvas-width").val(1920),n.find("#palleon-canvas-height").val(1080))}),n.find("#palleon-canvas-color").on("change",function(){var a=e(this).val();n.find("#custom-image-background").spectrum("set",a),""==a?(u.backgroundColor="transparent",u.requestRenderAll()):(u.backgroundColor=a,u.requestRenderAll())}),n.find("#palleon-media-library").on("click",function(){j="add-to-canvas"}),n.find("#palleon-img-media-library").on("click",function(){j="add-as-object"}),n.find("#palleon-img-replace-media-library").on("click",function(){j="replace-image"}),n.find("#palleon-overlay-img-media-library").on("click",function(){j="overlay-image"}),n.find("#agama-bg-media-library").on("click",function(){j="agama-bg-image"}),n.find("#modal-media-library").on("click",".media-library-grid>.palleon-masonry-item>.palleon-masonry-item-inner",function(){n.find("#palleon-canvas-loader").css("display","flex");var a=e(this).find("img").data("full"),t=new Image;if("add-to-canvas"==j){var l=a.substring(0,a.indexOf("?"));B(e(this).find("img").data("filename"),""!=l?l.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""):a.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),F(a,function(e){t.src=e,t.onload=function(){n.find("#palleon-canvas-img").attr("src",e),M("image")}})}else if("add-as-object"==j){var i=re()[1]/2,o=re()[0]/2;(r=u.getObjects().filter(e=>"printarea"==e.objectType)[0])&&(i=r.top,o=r.left),F(a,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:i,left:o,originX:"center",originY:"center"});u.add(e),r?(e.scaleToWidth(.8*r.width*u.getZoom()),e.isContainedWithinObject(r)||e.scaleToHeight(.8*r.height*u.getZoom())):(e.scaleToWidth(re()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(re()[1]/4)),u.setActiveObject(e),u.requestRenderAll(),n.find("#palleon-canvas-loader").hide(),u.fire("palleon:history",{type:"image",text:palleonParams.added})}})}else if("replace-image"==j)F(a,function(e){t.src=e,t.onload=function(){u.getActiveObject().setSrc(e),u.requestRenderAll(),n.find("#palleon-canvas-loader").hide(),u.fire("palleon:history",{type:"image",text:palleonParams.replaced})}});else if("overlay-image"==j)F(a,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t);e.set({scaleX:re()[0]/e.width,scaleY:re()[1]/e.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),u.setOverlayImage(e,u.renderAll.bind(u)),n.find("#palleon-overlay-wrap").show(),n.find("#palleon-overlay-preview").attr("src",a),setTimeout(function(){n.find("#palleon-canvas-loader").hide()},500)}});else if("agama-bg-image"==j){var r;(r=u.getObjects().filter(e=>"printarea"==e.objectType)[0])&&(n.find("#agama-bg-delete").trigger("click"),F(a,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t);e.scaleToWidth(r.width/2);var a=new fabric.StaticCanvas;a.setDimensions({width:e.getScaledWidth(),height:e.getScaledHeight()}),a.add(e),a.renderAll();var l=new fabric.Pattern({source:a.getElement(),repeat:"repeat",offsetX:0,offsetY:0,angle:0});r.clone(function(e){e.set({id:(new Date).getTime(),objectType:"clipPath",objectCaching:!1,fill:l,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!1,stroke:"transparent",strokeWidth:0}),u.add(e),u.sendToBack(e),u.sendToBack(r)}),n.find("#agama-bg-width").val(Math.round(parseInt(e.getScaledWidth()))),n.find("#agama-bg-width").attr("min",Math.round(parseInt(e.getScaledWidth())/4)),n.find("#agama-bg-width").attr("max",Math.round(4*parseInt(e.getScaledWidth()))),n.find("#agama-bg-offset-x").val(0),n.find("#agama-bg-offset-x").attr("max",Math.round(4*parseInt(e.getScaledWidth()))),n.find("#agama-bg-offset-y").val(0),n.find("#agama-bg-offset-y").attr("max",Math.round(4*parseInt(e.getScaledHeight()))),n.find("#agama-bg-width").trigger("input"),n.find("#agama-bg-offset-x").trigger("input"),n.find("#agama-bg-offset-y").trigger("input"),n.find("#agama-bg-image-settings").show(),n.find("#agama-bg-delete").show(),document.getElementById("agama-bg-width").oninput=function(){e.scaleToWidth(parseInt(this.value,10)),a.setDimensions({width:e.getScaledWidth(),height:e.getScaledHeight()}),u.requestRenderAll()},document.getElementById("agama-bg-offset-x").oninput=function(){l.offsetX=parseInt(this.value,10),u.requestRenderAll()},document.getElementById("agama-bg-offset-y").oninput=function(){l.offsetY=parseInt(this.value,10),u.requestRenderAll()},setTimeout(function(){u.requestRenderAll(),n.find("#palleon-canvas-loader").hide(),u.fire("palleon:history",{type:"image",text:palleonParams.added})},500)}}))}n.find("#modal-media-library").hide()}),n.find("#palleon-library-my-search").on("click",function(){var a=e(this).parent().find("input");if(n.find("#palleon-library-my-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),n.find("#palleon-library-my .palleon-masonry-item").show(),n.find("#palleon-library-my-pagination").length&&(n.find("#palleon-library-my-pagination").pagination("redraw"),n.find("#palleon-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var t=a.val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(n.find("#palleon-library-my .palleon-masonry-item").show(),n.find("#palleon-library-my-pagination").length&&(n.find("#palleon-library-my-pagination").pagination("redraw"),n.find("#palleon-library-my-pagination").pagination("selectPage",1))):(n.find("#palleon-library-my-pagination").length&&n.find("#palleon-library-my-pagination").pagination("destroy"),n.find("#palleon-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+t+'"]').show(),0===n.find("#palleon-library-my .palleon-masonry-item:visible").length&&n.find("#palleon-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),n.find("#palleon-library-all-search").on("click",function(){var a=e(this).parent().find("input");if(n.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),n.find("#palleon-library-all .palleon-masonry-item").show(),n.find("#palleon-library-all-pagination").length&&(n.find("#palleon-library-all-pagination").pagination("redraw"),n.find("#palleon-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var t=a.val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(n.find("#palleon-library-all .palleon-masonry-item").show(),n.find("#palleon-library-all-pagination").length&&(n.find("#palleon-library-all-pagination").pagination("redraw"),n.find("#palleon-library-all-pagination").pagination("selectPage",1))):(n.find("#palleon-library-all-pagination").length&&n.find("#palleon-library-all-pagination").pagination("destroy"),n.find("#palleon-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+t+'"]').show(),0===n.find("#palleon-library-all .palleon-masonry-item:visible").length&&n.find("#palleon-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),n.find("#palleon-library-my-refresh").on("click",function(){var a=e(this),t={action:"loadmyimgs",nonce:palleonParams.nonce,query:libraryMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(n.find("#palleon-library-my-pagination").remove(),n.find("#palleon-library-my").html(e),S.update(),A(n.find("#palleon-library-my")))},error:function(e,t,n){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-library-all-refresh").on("click",function(){var a=e(this),t={action:"loadallimgs",nonce:palleonParams.nonce,query:libraryAllRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(n.find("#palleon-library-all-pagination").remove(),n.find("#palleon-library-all").html(e),S.update(),A(n.find("#palleon-library-all")))},error:function(e,t,n){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-library-upload-img").on("change",function(a){var t=this.files[0],l=new FormData;l.append("file",t),l.append("action","uploadImgToLibrary"),l.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:l,success:function(e){n.find("#palleon-library-my-refresh").trigger("click")},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){!1===e.success?toastr.error(e.data,palleonParams.error):toastr.success(palleonParams.uploaded,palleonParams.success)})}),n.find(".media-library-grid").on("click",".palleon-library-delete",function(){if(window.confirm(palleonParams.answer2)){var a=e(this).data("target"),t=new FormData;t.append("target",a),t.append("action","deleteImgFromLibrary"),t.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){n.find("#palleon-library-my-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),n.find(".svg-library-grid").on("click",">.palleon-masonry-item>.palleon-masonry-item-inner",function(){var a=e(this).find("img").data("full");fabric.loadSVGFromURL(a,function(e,a){var t=fabric.util.groupSVGElements(e,a);t.set("originX","center"),t.set("originY","center"),t.set("left",re()[0]/2),t.set("top",re()[1]/2),t.set("objectType","customSVG"),t.scaleToWidth(re()[0]/2),t.scaleToHeight(re()[1]/2),u.add(t),u.setActiveObject(t),u.requestRenderAll()},function(){},{crossOrigin:"anonymous"}),n.find("#modal-svg-library").hide()}),n.find("#palleon-svg-library-my-search").on("click",function(){var a=e(this).parent().find("input");if(n.find("#palleon-svg-library-my-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),n.find("#palleon-svg-library-my .palleon-masonry-item").show(),n.find("#palleon-svg-library-my-pagination").length&&(n.find("#palleon-svg-library-my-pagination").pagination("redraw"),n.find("#palleon-svg-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var t=a.val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(n.find("#palleon-svg-library-my .palleon-masonry-item").show(),n.find("#palleon-svg-library-my-pagination").length&&(n.find("#palleon-svg-library-my-pagination").pagination("redraw"),n.find("#palleon-svg-library-my-pagination").pagination("selectPage",1))):(n.find("#palleon-svg-library-my-pagination").length&&n.find("#palleon-svg-library-my-pagination").pagination("destroy"),n.find("#palleon-svg-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+t+'"]').show(),0===n.find("#palleon-svg-library-my .palleon-masonry-item:visible").length&&n.find("#palleon-svg-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),n.find("#palleon-svg-library-all-search").on("click",function(){var a=e(this).parent().find("input");if(n.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),n.find("#palleon-svg-library-all .palleon-masonry-item").show(),n.find("#palleon-svg-library-all-pagination").length&&(n.find("#palleon-svg-library-all-pagination").pagination("redraw"),n.find("#palleon-svg-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var t=a.val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(n.find("#palleon-svg-library-all .palleon-masonry-item").show(),n.find("#palleon-svg-library-all-pagination").length&&(n.find("#palleon-svg-library-all-pagination").pagination("redraw"),n.find("#palleon-svg-library-all-pagination").pagination("selectPage",1))):(n.find("#palleon-svg-library-all-pagination").length&&n.find("#palleon-svg-library-all-pagination").pagination("destroy"),n.find("#palleon-svg-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+t+'"]').show(),0===n.find("#palleon-svg-library-all .palleon-masonry-item:visible").length&&n.find("#palleon-svg-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),n.find("#palleon-svg-library-my-refresh").on("click",function(){var a=e(this),t={action:"loadmyimgs",nonce:palleonParams.nonce,query:SVGlibraryMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(n.find("#palleon-svg-library-my-pagination").remove(),n.find("#palleon-svg-library-my").html(e),S.update(),A(n.find("#palleon-svg-library-my")))},error:function(e,t,n){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-svg-library-all-refresh").on("click",function(){var a=e(this),t={action:"loadallimgs",nonce:palleonParams.nonce,query:SVGlibraryAllRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(n.find("#palleon-svg-library-all-pagination").remove(),n.find("#palleon-svg-library-all").html(e),S.update(),A(n.find("#palleon-svg-library-all")))},error:function(e,t,n){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-svg-library-upload-img").on("change",function(a){var t=this.files[0],l=new FormData;l.append("file",t),l.append("action","uploadSVGToLibrary"),l.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:l,success:function(e){n.find("#palleon-svg-library-my-refresh").trigger("click")},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){!1===e.success?toastr.error(e.data,palleonParams.error):toastr.success(palleonParams.uploaded,palleonParams.success)})}),n.find(".svg-library-grid").on("click",".palleon-svg-library-delete",function(){if(window.confirm(palleonParams.answer2)){var a=e(this).data("target"),t=new FormData;t.append("target",a),t.append("action","deleteImgFromLibrary"),t.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){n.find("#palleon-svg-library-my-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),n.find("#palleon-pexels-search").on("click",function(){var a=n.find("#pexels-orientation").val(),t=n.find("#pexels-color").val(),l=n.find("#palleon-pexels-keyword").val(),i={action:"pexelsSearch",nonce:palleonParams.nonce,orientation:a,color:t,keyword:l,page:"1"};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",beforeSend:function(e){n.find("#pexels").css("pointer-events","none"),n.find("#pexels-menu,#pexels-output").css("opacity",.5)},success:function(e){e?(n.find("#pexels-output").html(e),S.update()):n.find("#pexels-output").html(e)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){n.find("#pexels").css("pointer-events","auto"),n.find("#pexels-menu,#pexels-output").css("opacity",1)})}),n.find("#palleon-pexels-keyword").on("keyup input",function(){""==e(this).val()?(n.find("#pexels-orientation").val(""),n.find("#pexels-color").val(""),n.find("#pexels-orientation").prop("disabled",!0),n.find("#pexels-color").prop("disabled",!0)):(n.find("#pexels-orientation").prop("disabled",!1),n.find("#pexels-color").prop("disabled",!1))}),n.find("#pexels-output").on("click","#pexels-loadmore",function(){var a=n.find("#pexels-orientation").val(),t=n.find("#pexels-color").val(),l=n.find("#palleon-pexels-keyword").val(),i={action:"pexelsSearch",nonce:palleonParams.nonce,orientation:a,color:t,keyword:l,page:parseInt(e(this).data("page"))+1};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",beforeSend:function(e){n.find("#pexels").css("pointer-events","none"),n.find("#pexels-menu,#pexels-output").css("opacity",.5),n.find("#pexels-loadmore").html(palleonParams.loading)},success:function(e){e?(n.find("#pexels-loadmore").remove(),n.find("#pexels-output > .pexels-grid:last-child").after(e),S.update()):n.find("#pexels-loadmore").prop("disabled",!1)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){n.find("#pexels").css("pointer-events","auto"),n.find("#pexels-menu,#pexels-output").css("opacity",1),n.find("#pexels-loadmore").html(palleonParams.loadmore)})}),n.find("#palleon-undo").on("click",function(){var e=n.find("#palleon-history-list li.active").next("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),n.find("#palleon-redo").prop("disabled",!1)):n.find("#palleon-undo").prop("disabled",!0)}),n.find("#palleon-redo").on("click",function(){var e=n.find("#palleon-history-list li.active").prev("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),n.find("#palleon-undo").prop("disabled",!1)):n.find("#palleon-redo").prop("disabled",!0)}),n.find("#palleon-history-list").on("click",".palleon-btn.danger",function(){e(this).parent().parent().remove(),e("#palleon-history-list li").length||(n.find("#palleon-history").prop("disabled",!0),n.find("#palleon-undo").prop("disabled",!0),n.find("#palleon-redo").prop("disabled",!0),n.find(".palleon-modal").hide())}),n.find("#palleon-history-list").on("click",".palleon-btn.primary",function(){n.find("#palleon-history-list li").removeClass("active"),e(this).parent().parent().addClass("active");var a=n.find("#palleon-history-list li.active").next("li"),t=n.find("#palleon-history-list li.active").prev("li");a.length?n.find("#palleon-undo").prop("disabled",!1):n.find("#palleon-undo").prop("disabled",!0),t.length?n.find("#palleon-redo").prop("disabled",!1):n.find("#palleon-redo").prop("disabled",!0);var l=JSON.parse(e(this).parent().find("script").html());n.find(".palleon-modal").hide(),F(l.backgroundImage.src,function(e){l.backgroundImage.src=e,H(l),n.find("#palleon-canvas-loader").hide()})}),n.find("#palleon-clear-history").on("click",function(){window.confirm(palleonParams.answer3)&&(n.find("#palleon-history-list li").remove(),n.find("#palleon-history").prop("disabled",!0),n.find("#palleon-undo").prop("disabled",!0),n.find("#palleon-redo").prop("disabled",!0),n.find(".palleon-modal").hide())}),u.on("palleon:history",function(e){Z(V(e.type)+" "+e.text)});var J=!1;u.on("mouse:up",function(e){var a=e.target;if(null!==a){var t=a.objectType;J&&Z(V(t)+" "+palleonParams.moved)}void 0!==u.overlayImage&&null!==u.overlayImage&&u.overlayImage.set("opacity",1)}),u.on("object:moving",function(e){J=!0,void 0!==u.overlayImage&&null!==u.overlayImage&&u.overlayImage.set("opacity",.7);var a=d,t=c;0!=p&&180!=p&&-180!=p||(a=c,t=d);var n=e.target,l=n.getScaledWidth(),i=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(n.top<0&&n.left<0?(n.top=0,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0&&l+n.left>a?(n.top=0,n.left=a-l,n.lockMovementX=!0,n.lockMovementY=!0):i+n.top>t&&n.left<0?(n.top=t-i,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):i+n.top>t&&l+n.left>a?(n.top=t-i,n.left=a-l,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0?(n.top=0,n.lockMovementY=!0):n.left<0?(n.left=0,n.lockMovementX=!0):l+n.left>a?(n.left=a-l,n.lockMovementX=!0):i+n.top>t&&(n.top=t-i,n.lockMovementY=!0),n.setCoords())}),u.on("object:scaling",function(e){var a=d,t=c;0!=p&&180!=p&&-180!=p||(a=c,t=d);var n=e.target,l=n.getScaledWidth(),i=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(l>=a&&(n.set({scaleX:a/n.width}),n.lockScalingX=!0),i>=t&&(n.set({scaleY:t/n.height}),n.lockScalingY=!0),n.top<0&&(n.top=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),n.left<0&&(n.left=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),l+n.left>a&&(n.left=a-l,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),i+n.top>t&&(n.top=t-i,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()))}),u.on("object:added",function(a){var t,l,i=a.target;if("clipPath"!=i.objectType&&"drawing"!=i.objectType&&"watermark"!=i.objectType)if(!0===u.isDrawingMode)i.set("objectType","drawing"),i.set("selectable",!1),i.set("lockMovementX",!0),i.set("lockMovementY",!0),i.set("lockRotation",!0);else{var o=u.getObjects().indexOf(i),r="",s="Object",c="category",d="layer-visible",p="visibility",f="layer-unlocked",g="lock_open";0==i.visible&&(d="layer-hidden",p="visibility_off"),0==i.selectable&&(f="layer-locked",g="lock"),i.set("id",(new Date).getTime()),n.find("#palleon-layers > li").removeClass("active"),"textbox"==i.objectType?(s=i.text,c="title"):"drawing"==i.objectType?(s=palleonParams.freeDrawing,c="brush"):"frame"==i.objectType?(s=palleonParams.frame,c="wallpaper"):"image"==i.objectType?(s=palleonParams.image,c="image"):"circle"==i.objectType?s=palleonParams.circle:"square"==i.objectType?s=palleonParams.square:"rectangle"==i.objectType?s=palleonParams.rectangle:"triangle"==i.objectType?s=palleonParams.triangle:"ellipse"==i.objectType?s=palleonParams.ellipse:"trapezoid"==i.objectType?s=palleonParams.trapezoid:"pentagon"==i.objectType?s=palleonParams.pentagon:"octagon"==i.objectType?s=palleonParams.octagon:"emerald"==i.objectType?s=palleonParams.emerald:"star"==i.objectType?s=palleonParams.star:"element"==i.objectType?(s=palleonParams.element,c="star"):"customSVG"==i.objectType?s=palleonParams.customSvg:"printarea"==i.objectType?(s=palleonParams.printArea,c="print"):"qrCode"==i.objectType&&(s=palleonParams.qrCode,c="qr_code"),"layerName"in i&&(s=i.layerName),r="frontend"==palleonParams.version&&"printarea"==i.objectType?'<li id="'+i.id+'" data-type="'+i.objectType+'" class="layer-'+i.objectType+' disabled" data-sort="'+o+'"><span class="material-icons">'+c+'</span><div class="layer-name">'+s+'</div><a class="material-icons layer-visibility '+d+'" title="'+palleonParams.showhide+'">'+p+"</a></li>":'<li id="'+i.id+'" data-type="'+i.objectType+'" class="layer-'+i.objectType+' active" data-sort="'+o+'"><span class="material-icons">'+c+'</span><input type="text" class="layer-name" autocomplete="off" value="'+s+'" /><span class="material-icons layer-settings">settings</span><div class="layer-icons"><a class="material-icons lock-layer '+f+'" title="'+palleonParams.lockunlock+'">'+g+'</a><a class="material-icons text-success duplicate-layer" title="'+palleonParams.duplicate+'">content_copy</a><a class="material-icons layer-visibility '+d+'" title="'+palleonParams.showhide+'">'+p+'</a><a class="material-icons text-danger delete-layer" title="'+palleonParams.delete+'">clear</a></div></li>',n.find("#palleon-layers").prepend(r),t=i.id,(l=n.find("#palleon-layers #"+t)).find("a.delete-layer").on("click",function(e){e.preventDefault(),u.fire("palleon:history",{type:l.data("type"),text:palleonParams.removed});var a=u.getObjects();a.filter(e=>e.id==t).forEach(e=>u.remove(e)),l.remove(),u.requestRenderAll(),n.find("#palleon-layers").sortable("refresh"),K()}),function(e){var a=n.find("#palleon-layers #"+e);a.find("a.duplicate-layer").on("click",function(t){t.preventDefault();var l=u.getObjects();l.filter(a=>a.id==e).forEach(e=>e.clone(function(a){a.set("id",(new Date).getTime()),a.set("objectType",e.objectType),u.add(a),u.setActiveObject(a)})),u.requestRenderAll(),n.find("#palleon-layers").sortable("refresh"),u.fire("palleon:history",{type:a.data("type"),text:palleonParams.added})})}(i.id),function(a){var t=a.id;n.find("#palleon-layers #"+t).find("a.layer-visibility").on("click",function(n){n.preventDefault();var l=u.getObjects();e(this).hasClass("layer-visible")?(e(this).removeClass("layer-visible"),e(this).addClass("layer-hidden"),e(this).html("visibility_off"),"frontend"==palleonParams.version&&"printarea"==a.objectType?($=a.strokeWidth,l.filter(e=>e.id==t).forEach(e=>e.set("strokeWidth",0))):l.filter(e=>e.id==t).forEach(e=>e.set("visible",!1))):e(this).hasClass("layer-hidden")&&(e(this).removeClass("layer-hidden"),e(this).addClass("layer-visible"),e(this).html("visibility"),"frontend"==palleonParams.version&&"printarea"==a.objectType?l.filter(e=>e.id==t).forEach(e=>e.set("strokeWidth",$)):l.filter(e=>e.id==t).forEach(e=>e.set("visible",!0))),u.requestRenderAll()})}(i),function(a){n.find("#palleon-layers #"+a).find("a.lock-layer").on("click",function(a){a.preventDefault();var t=u.getActiveObject();e(this).hasClass("layer-unlocked")?(e(this).removeClass("layer-unlocked"),e(this).addClass("layer-locked"),e(this).html("lock"),t.set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,selectable:!1})):e(this).hasClass("layer-locked")&&(e(this).removeClass("layer-locked"),e(this).addClass("layer-unlocked"),e(this).html("lock_open"),t.set({lockMovementX:!1,lockMovementY:!1,lockRotation:!1,selectable:!0})),u.requestRenderAll()})}(i.id),function(a){var t=n.find("#palleon-layers #"+a);"frontend"==palleonParams.version&&"printarea"==t.data("type")||t.on("click",function(a){var t=u.getObjects(),l=e(this).attr("id");t.filter(e=>e.id==l).forEach(e=>u.setActiveObject(e)),n.find("#palleon-layers > li").removeClass("active"),e(this).addClass("active"),u.requestRenderAll()})}(i.id),function(a){n.find("#palleon-layers #"+a).find(".layer-name").on("change",function(a){var t=u.getObjects(),n=e(this).parent("li").attr("id");t.filter(e=>e.id==n).forEach(a=>a.set({layerName:e(this).val()}))})}(i.id),n.find("#palleon-layers").sortable("refresh"),K(),"printarea"!=i.objectType?(function(e){e.controls.deleteControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:14,cursorStyle:"pointer",mouseUpHandler:Y,render:z,cornerSize:24})}(i),function(e){e.controls.cloneControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:-14,cursorStyle:"pointer",mouseUpHandler:D,render:E,cornerSize:24})}(i)):function(e){e.controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})}}(i)}}),u.on("object:modified",function(e){var a=e.target;"textbox"==a.objectType&&a.id&&(n.find("#palleon-layers #"+a.id+" .layer-name").html(a.text),n.find("#text-rotate").val(parseInt(u.getActiveObject().angle)),n.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"image"==a.objectType&&a.id&&(n.find("#img-rotate").val(parseInt(u.getActiveObject().angle)),n.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"element"==a.objectType&&a.id&&(n.find("#element-rotate").val(parseInt(u.getActiveObject().angle)),n.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"customSVG"==a.objectType&&a.id&&(n.find("#customsvg-rotate").val(parseInt(u.getActiveObject().angle)),n.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),P.includes(a.objectType)&&a.id&&(n.find("#shape-rotate").val(parseInt(u.getActiveObject().angle)),n.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"clipPath"==a.objectType&&(a.lockScalingX=!1,a.lockScalingY=!1,a.lockMovementX=!1,a.lockMovementY=!1)}),u.on("path:created",function(e){if(!0===u.isDrawingMode){var a=u.getObjects().filter(e=>"printarea"==e.objectType)[0];if(a){var t=u.getObjects().filter(e=>"drawing"==e.objectType).slice(-1)[0];t.isContainedWithinObject(a)||u.remove(t)}}}),n.find(".palleon-horizontal-center").on("click",function(){var e=u.getActiveObject(),a=u.getObjects().filter(e=>"printarea"==e.objectType)[0];a&&"printarea"!=e.objectType?(e.set("originX","left"),e.set("left",a.left-a.width/2+(a.getScaledWidth()-e.getScaledWidth())/2)):(e.set("originX","center"),e.set("left",re()[0]/2)),u.requestRenderAll()}),n.find(".palleon-vertical-center").on("click",function(){var e=u.getActiveObject(),a=u.getObjects().filter(e=>"printarea"==e.objectType)[0];a&&"printarea"!=e.objectType?(e.set("top",a.top-a.height/2+(a.getScaledHeight()-e.getScaledHeight())/2),e.set("top",re()[1]/2)):(e.set("originY","center"),e.set("top",re()[1]/2)),u.requestRenderAll()}),u.on("selection:created",function(e){Q(e.selected)}),u.on("selection:updated",function(e){Q(e.selected),n.find("#palleon-font-family").trigger("change")}),u.on("selection:cleared",function(){n.find("#palleon-text-settings").hide(),n.find("#palleon-image-settings").hide(),n.find("#palleon-shape-settings").hide(),n.find("#palleon-custom-element-options").hide(),n.find("#palleon-custom-element-options-info").show(),n.find("#palleon-custom-svg-options").hide(),n.find("#palleon-layers > li").removeClass("active")}),n.find("#palleon-layers").sortable({items:"li:not(.disabled)",placeholder:"layer-placeholder",axis:"y",update:function(a,t){var l=u.getObjects();n.find("#palleon-layers li:not(.disabled)").each(function(a,t){e(this).attr("data-sort",a+1),l.filter(e=>e.id==t.id).forEach(e=>e.moveTo(-(a+1)))}),u.requestRenderAll()},create:function(e,a){K()}}).disableSelection(),n.find("#palleon-layers").on("click",".layer-settings",function(){var a=e(this).next();e(this).hasClass("active")?(e(this).removeClass("active"),a.hide()):(n.find("#palleon-layers .layer-icons").hide(),n.find("#palleon-layers .layer-settings").removeClass("active"),e(this).addClass("active"),a.show())});var $="";function K(){n.find("#palleon-layers li").length?(n.find("#palleon-no-layer").hide(),n.find("#palleon-layer-delete-wrap").css("visibility","visible")):(n.find("#palleon-no-layer").show(),n.find("#palleon-layer-delete-wrap").css("visibility","hidden"))}function Q(a){if(n.find("#palleon-layers li").removeClass("active"),a.length>=2)for(var t=0;t<a.length;t++)n.find("#palleon-layers #"+a[t].id).addClass("active");else void 0!==(a=a[0])&&a.objectType?("textbox"==a.objectType?(n.find("#palleon-text-settings").show(),function(e){n.find("#palleon-text-input").val(e.text),n.find("#palleon-font-family").val(e.fontFamily),n.find("#palleon-font-family").trigger("change"),"none"==e.gradientFill?(n.find("#palleon-text-gradient").val("none"),n.find("#palleon-text-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(n.find("#palleon-text-gradient").val("vertical"),4==e.fill.colorStops.length?(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#text-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#text-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",""),n.find("#text-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(n.find("#palleon-text-gradient").val("horizontal"),4==e.fill.colorStops.length?(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#text-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#text-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#text-gradient-color-3").spectrum("set",""),n.find("#text-gradient-color-4").spectrum("set","")));n.find("#palleon-text-gradient").trigger("change"),"bold"==e.fontWeight?n.find("#format-bold").addClass("active"):n.find("#format-bold").removeClass("active");"italic"==e.fontStyle?n.find("#format-italic").addClass("active"):n.find("#format-italic").removeClass("active");1==e.underline?n.find("#format-underline").addClass("active"):n.find("#format-underline").removeClass("active");"left"==e.textAlign&&(n.find(".format-align").removeClass("active"),n.find("#format-align-left").addClass("active"));"right"==e.textAlign&&(n.find(".format-align").removeClass("active"),n.find("#format-align-right").addClass("active"));"center"==e.textAlign&&(n.find(".format-align").removeClass("active"),n.find("#format-align-center").addClass("active"));"justify"==e.textAlign&&(n.find(".format-align").removeClass("active"),n.find("#format-align-justify").addClass("active"));n.find("#palleon-font-size").val(e.fontSize),n.find("#palleon-outline-size").val(e.strokeWidth),n.find("#palleon-line-height").val(e.lineHeight),n.find("#palleon-letter-spacing").val(e.charSpacing),n.find("#palleon-outline-color").spectrum("set",e.stroke),n.find("#palleon-text-background").spectrum("set",e.textBackgroundColor),null==e.shadow?n.find("#palleon-text-shadow").prop("checked",!1):(n.find("#palleon-text-shadow").prop("checked",!0),n.find("#text-shadow-color").spectrum("set",e.shadow.color),n.find("#text-shadow-blur").val(e.shadow.blur),n.find("#text-shadow-offset-x").val(e.shadow.offsetX),n.find("#text-shadow-offset-y").val(e.shadow.offsetY));n.find("#palleon-text-shadow").trigger("change"),1==e.flipX?n.find("#text-flip-x").addClass("active"):n.find("#text-flip-x").removeClass("active");1==e.flipY?n.find("#text-flip-y").addClass("active"):n.find("#text-flip-y").removeClass("active");n.find("#text-skew-x").val(e.skewX),n.find("#text-skew-x").parent().parent().find(".slider-label span").html(e.skewX),n.find("#text-skew-y").val(e.skewY),n.find("#text-skew-y").parent().parent().find(".slider-label span").html(e.skewY),n.find("#text-rotate").val(parseInt(e.angle)),n.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle))}(a),n.find("#palleon-btn-text").hasClass("active")||n.find("#palleon-btn-text").trigger("click"),n.find("#palleon-font-family").trigger("change")):n.find("#palleon-text-settings").hide(),"image"==a.objectType?(n.find("#palleon-image-settings").show(),function(e){n.find("#img-border-radius").val(e.roundedCorders),n.find("#img-border-radius").parent().parent().find(".slider-label span").html(e.roundedCorders),null==e.shadow?n.find("#palleon-image-shadow").prop("checked",!1):(n.find("#palleon-image-shadow").prop("checked",!0),n.find("#image-shadow-color").spectrum("set",e.shadow.color),n.find("#image-shadow-blur").val(e.shadow.blur),n.find("#image-shadow-offset-x").val(e.shadow.offsetX),n.find("#image-shadow-offset-y").val(e.shadow.offsetY));n.find("#palleon-image-shadow").trigger("change"),n.find("#img-border-width").val(e.strokeWidth),n.find("#img-border-color").spectrum("set",e.stroke),n.find("#img-opacity").val(e.opacity),n.find("#img-opacity").parent().parent().find(".slider-label span").html(e.opacity),n.find("#img-skew-x").val(e.skewX),n.find("#img-skew-x").parent().parent().find(".slider-label span").html(e.skewX),n.find("#img-skew-y").val(e.skewY),n.find("#img-skew-y").parent().parent().find(".slider-label span").html(e.skewY),n.find("#img-rotate").val(parseInt(e.angle)),n.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle))}(a),n.find("#palleon-btn-image").hasClass("active")||(n.find("#palleon-btn-image").trigger("click"),n.find("#palleon-img-mode").trigger("click"))):n.find("#palleon-image-settings").hide(),"frame"==a.objectType&&(n.find("#palleon-btn-frames").hasClass("active")||n.find("#palleon-btn-frames").trigger("click")),"element"==a.objectType?(n.find("#palleon-custom-element-options").show(),n.find("#palleon-custom-element-options-info").hide(),function(e){"none"==e.gradientFill?(n.find("#palleon-element-gradient").val("none"),n.find("#palleon-element-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(n.find("#palleon-element-gradient").val("vertical"),4==e.fill.colorStops.length?(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#element-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#element-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",""),n.find("#element-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(n.find("#palleon-element-gradient").val("horizontal"),4==e.fill.colorStops.length?(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#element-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#element-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#element-gradient-color-3").spectrum("set",""),n.find("#element-gradient-color-4").spectrum("set","")));n.find("#palleon-element-gradient").trigger("change"),n.find("#element-opacity").val(e.opacity),n.find("#element-opacity").parent().parent().find(".slider-label span").html(e.opacity),n.find("#element-skew-x").val(e.skewX),n.find("#element-skew-x").parent().parent().find(".slider-label span").html(e.skewX),n.find("#element-skew-y").val(e.skewY),n.find("#element-skew-y").parent().parent().find(".slider-label span").html(e.skewY),n.find("#element-rotate").val(parseInt(e.angle)),n.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle)),null==e.shadow?n.find("#palleon-element-shadow").prop("checked",!1):(n.find("#palleon-element-shadow").prop("checked",!0),n.find("#element-shadow-color").spectrum("set",e.shadow.color),n.find("#element-shadow-blur").val(e.shadow.blur),n.find("#element-shadow-offset-x").val(e.shadow.offsetX),n.find("#element-shadow-offset-y").val(e.shadow.offsetY));n.find("#palleon-element-shadow").trigger("change")}(a),n.find("#palleon-btn-elements").hasClass("active")||n.find("#palleon-btn-elements").trigger("click"),n.find("#palleon-custom-element-open").trigger("click")):(n.find("#palleon-custom-element-options").hide(),n.find("#palleon-custom-element-options-info").show()),"customSVG"==a.objectType?(n.find("#palleon-custom-svg-options").show(),function(e){n.find("#customsvg-opacity").val(e.opacity),n.find("#customsvg-opacity").parent().parent().find(".slider-label span").html(e.opacity),n.find("#customsvg-skew-x").val(e.skewX),n.find("#customsvg-skew-x").parent().parent().find(".slider-label span").html(e.skewX),n.find("#customsvg-skew-y").val(e.skewY),n.find("#customsvg-skew-y").parent().parent().find(".slider-label span").html(e.skewY),n.find("#customsvg-rotate").val(parseInt(e.angle)),n.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle))}(a),n.find("#palleon-btn-icons").hasClass("active")||n.find("#palleon-btn-icons").trigger("click"),n.find("#palleon-custom-svg-open").trigger("click")):n.find("#palleon-custom-svg-options").hide(),P.includes(a.objectType)?("printarea"==a.objectType?(n.find("#shape-opacity").parent().parent().hide(),n.find("#shape-skew-x").parent().parent().hide(),n.find("#shape-skew-y").parent().parent().hide(),n.find("#shape-rotate").parent().parent().hide()):(n.find("#shape-opacity").parent().parent().show(),n.find("#shape-skew-x").parent().parent().show(),n.find("#shape-skew-y").parent().parent().show(),n.find("#shape-rotate").parent().parent().show()),C.includes(a.objectType)?n.find("#shape-custom-width-wrap").show():n.find("#shape-custom-width-wrap").hide(),n.find("#palleon-shape-settings").show(),function(e){n.find("#shape-outline-width").val(e.strokeWidth),"none"==e.gradientFill?(n.find("#palleon-shape-gradient").val("none"),n.find("#palleon-shape-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(n.find("#palleon-shape-gradient").val("vertical"),4==e.fill.colorStops.length?(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#shape-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#shape-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",""),n.find("#shape-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(n.find("#palleon-shape-gradient").val("horizontal"),4==e.fill.colorStops.length?(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#shape-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),n.find("#shape-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(n.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),n.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),n.find("#shape-gradient-color-3").spectrum("set",""),n.find("#shape-gradient-color-4").spectrum("set","")));n.find("#palleon-shape-gradient").trigger("change"),n.find("#shape-outline-color").spectrum("set",e.stroke),null==e.shadow?n.find("#palleon-shape-shadow").prop("checked",!1):(n.find("#palleon-shape-shadow").prop("checked",!0),n.find("#shape-shadow-color").spectrum("set",e.shadow.color),n.find("#shape-shadow-blur").val(e.shadow.blur),n.find("#shape-shadow-offset-x").val(e.shadow.offsetX),n.find("#shape-shadow-offset-y").val(e.shadow.offsetY));n.find("#palleon-shape-shadow").trigger("change"),n.find("#shape-opacity").val(e.opacity),n.find("#shape-opacity").parent().parent().find(".slider-label span").html(e.opacity),n.find("#shape-skew-x").val(e.skewX),n.find("#shape-skew-x").parent().parent().find(".slider-label span").html(e.skewX),n.find("#shape-skew-y").val(e.skewX),n.find("#shape-skew-y").parent().parent().find(".slider-label span").html(e.skewY),n.find("#shape-rotate").val(parseInt(e.angle)),n.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle)),"printarea"==e.objectType?(n.find("#shape-custom-width").val(e.width),n.find("#shape-custom-height").val(e.height)):(n.find("#shape-custom-width").val(""),n.find("#shape-custom-height").val(""))}(a),n.find("#palleon-btn-shapes").hasClass("active")||n.find("#palleon-btn-shapes").trigger("click")):n.find("#palleon-shape-settings").hide(),a.id&&n.find("#palleon-layers #"+a.id).addClass("active")):e.each(a,function(e,a){n.find("#palleon-layers #"+a.id).addClass("active")})}function ee(){fabric.Image.fromURL(s,function(e){u.setBackgroundImage(e,u.renderAll.bind(u),{objectType:"BG",mode:o,top:0,left:0,scaleX:f,scaleY:g,selectable:!1,angle:p,originX:m,originY:h,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})})}function ae(e){var a=d,t=c;if(0!=p&&180!=p&&-180!=p||(a=c,t=d),e)e/=100,u.setZoom(e);else{var l=n.find("#palleon-img-zoom").val(),i=1,o=0;a<n.find("#palleon-content").width()&&t<n.find("#palleon-content").height()?(u.setZoom(1),n.find("#palleon-img-zoom").val(100)):(a>n.find("#palleon-content").width()&&l>100*(i=(n.find("#palleon-content").width()-60)/a).toFixed(2)&&(u.setZoom(i.toFixed(2)),n.find("#palleon-img-zoom").val(100*i.toFixed(2)),o=i.toFixed(2)),t>n.find("#palleon-content").height()&&l>100*(i=n.find("#palleon-content").height()/t).toFixed(2)&&(0===o||o>i.toFixed(2))&&(u.setZoom(i.toFixed(2)),n.find("#palleon-img-zoom").val(100*i.toFixed(2))))}u.setWidth(a*u.getZoom()),u.setHeight(t*u.getZoom()),!0===u.isDrawingMode&&(n.find("#palleon-erase-btn").hasClass("active")&&n.find("#eraser-width").trigger("input"),n.find("#palleon-draw-btn").hasClass("active")&&n.find("#brush-width").trigger("input"))}n.find("#palleon-layer-delete").on("click",function(){if(window.confirm(palleonParams.answer4)){var e=n.find("#palleon-layer-select").val(),a=u.getObjects();"all"==e?(a.filter(e=>"printarea"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers > li:not(.layer-printarea)").remove()):(a.filter(a=>a.objectType==e&&"printarea"!=a.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers > li.layer-"+e).remove()),u.requestRenderAll(),n.find("#palleon-layers").sortable("refresh"),K()}}),n.find("#palleon-img-drag").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),n.find("#palleon-canvas-overlay").hide(),n.find("#palleon-canvas-wrap").draggable("disable")):(e(this).addClass("active"),n.find("#palleon-canvas-overlay").show(),n.find("#palleon-canvas-wrap").draggable("enable"))}),n.find(".palleon-counter input.palleon-form-field").on("input",function(){ae(parseInt(e(this).val()))});var te=function(e){n.find("#palleon-resize-width").val(Math.round(e.width)),n.find("#palleon-resize-height").val(Math.round(e.height)),n.find("#palleon-img-width").html(Math.round(e.width)),n.find("#palleon-img-height").html(Math.round(e.height)),n.find("#palleon-crop-width").val(Math.round(e.width/2)),n.find("#palleon-crop-height").val(Math.round(e.height/2)),n.find("#palleon-resize-width").data("size",Math.round(e.width)),n.find("#palleon-resize-height").data("size",Math.round(e.height)),"image"==o&&(n.find("#palleon-crop-width").data("max",Math.round(e.width)),n.find("#palleon-crop-height").data("max",Math.round(e.height)))};function ne(){var e=u.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!1)),u.backgroundColor="transparent";var a=O(u.toDataURL({format:"png",enableRetinaScaling:!1}));s=URL.createObjectURL(a),n.find("#palleon-canvas-img").attr("src",s),u.backgroundColor=n.find("#custom-image-background").val(),e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!0))}function le(){var e=u.getObjects();v.moveTo(9999),u.setActiveObject(v),n.find("#palleon-crop-btns").removeClass("disabled"),n.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","none"),n.find(".palleon-icon-panel-content ul.palleon-accordion > li.accordion-crop").css("pointer-events","auto"),e.filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!1))}function ie(e){0==p||180==p||-180==p?(u.setDimensions({width:d,height:c}),f=u.height/r.width,g=u.width/r.height):(u.setDimensions({width:c,height:d}),f=u.width/r.width,g=u.height/r.height),"right"==e?0==p?(p=90,m="left",h="bottom"):90==p?(p=180,m="right",h="bottom"):180==p?(p=270,m="right",h="top"):270==p?(p=0,m="left",h="top"):-90==p?(p=0,m="left",h="top"):-180==p?(p=-90,m="right",h="top"):-270==p&&(p=-180,m="right",h="bottom"):"left"==e&&(0==p?(p=-90,m="right",h="top"):-90==p?(p=-180,m="right",h="bottom"):-180==p?(p=-270,m="left",h="bottom"):-270==p?(p=0,m="left",h="top"):90==p?(p=0,m="left",h="top"):180==p?(p=90,m="left",h="bottom"):270==p&&(p=180,m="right",h="bottom")),u.backgroundImage.set({scaleX:f,scaleY:g,angle:p,originX:m,originY:h});var a=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:u.height,height:u.width,gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});u.add(a),u.discardActiveObject();var t=new fabric.ActiveSelection(u.getObjects(),{canvas:u});u.setActiveObject(t);var n=u.getActiveObject();"right"==e?n.set({angle:90,originX:"left",originY:"bottom"}):"left"==e&&n.set({angle:-90,originX:"right",originY:"top"}),u.remove(a),u.discardActiveObject(),te(u),ae(),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.rotated})}n.find("#palleon-crop-style").on("change",function(){if(""!=e(this).val()&&e(this).select2("enable",!1),"freeform"==e(this).val())(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:c/2,height:d/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1})},u.add(v),le();else if("custom"==e(this).val()){n.find(".crop-custom").css("display","flex");var a=parseInt(n.find("#palleon-crop-width").val()),t=parseInt(n.find("#palleon-crop-height").val());(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:a,height:t,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})},u.add(v),le()}else if("square"==e(this).val()){var l=d/2;c>=d&&(l=c/2),(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:l,height:l,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},u.add(v),le()}else if("original"==e(this).val())(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:c/2,height:d/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},u.add(v),le();else{u.getObjects().filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType&&"drawing"!=e.objectType).forEach(e=>e.set("selectable",!0)),n.find(".crop-custom").css("display","none"),n.find("#palleon-crop-btns").addClass("disabled"),n.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","auto")}}),n.find("#palleon-crop-cancel").on("click",function(){n.find("#palleon-crop-btns").addClass("disabled"),n.find("#palleon-crop-style").select2("enable"),n.find("#palleon-crop-style").val(""),n.find("#palleon-crop-style").trigger("change"),u.remove(""),u.remove(v)}),n.find("#palleon-crop-apply").on("click",function(){if(window.confirm(palleonParams.answer5)){n.find("#palleon-crop-btns").addClass("disabled"),n.find("#palleon-crop-style").select2("enable"),n.find("#palleon-crop-style").val(""),n.find("#palleon-crop-style").trigger("change"),u.setZoom(1),n.find("#palleon-img-zoom").val(100);var e=v.getBoundingRect();u.setWidth(e.width-1),u.setHeight(e.height-1),u.backgroundImage.set({top:-e.top,left:-e.left}),u.remove(""),u.remove(v),ne(),n.find("#palleon-canvas-img-wrap").imagesLoaded(function(){c=u.width,d=u.height,p=0,m="left",h="top",f=1,g=1,ee(),te(u),ae(),u.requestRenderAll(),setTimeout(function(){u.fire("palleon:history",{type:"BG",text:palleonParams.cropped})},500)})}}),n.find("#palleon-crop-width").bind("input paste",function(){if(n.find("#palleon-crop-lock").hasClass("active")){var a=e(this).data("max")/n.find("#palleon-crop-height").data("max");n.find("#palleon-crop-height").val(Math.round(this.value/a))}v.set("width",parseInt(e(this).val())),v.set("height",parseInt(n.find("#palleon-crop-height").val())),u.requestRenderAll()}),n.find("#palleon-crop-height").bind("input paste",function(){if(n.find("#palleon-crop-lock").hasClass("active")){var a=e(this).data("max")/n.find("#palleon-crop-width").data("max");n.find("#palleon-crop-width").val(Math.round(this.value/a))}v.set("height",parseInt(e(this).val())),v.set("width",parseInt(n.find("#palleon-crop-width").val())),u.requestRenderAll()}),n.find("#palleon-resize-apply").on("click",function(){window.confirm(palleonParams.answer6)&&function(){var e=parseInt(n.find("#palleon-resize-width").val()),a=parseInt(n.find("#palleon-resize-height").val());c=e,d=a,u.setZoom(1),n.find("#palleon-img-zoom").val(100),u.setWidth(e),u.setHeight(a),0==p||180==p||-180==p?(f=u.width/n.find("#palleon-canvas-img")[0].width,g=u.height/n.find("#palleon-canvas-img")[0].height):(f=u.height/n.find("#palleon-canvas-img")[0].width,g=u.width/n.find("#palleon-canvas-img")[0].height),u.backgroundImage.set({scaleX:f,scaleY:g}),u.discardActiveObject();var t=new fabric.ActiveSelection(u.getObjects(),{canvas:u});u.setActiveObject(t);var l=u.getActiveObject();l.set({top:l.top*g,left:l.left*f,scaleX:f,scaleY:g}),ne(),n.find("#palleon-canvas-img-wrap").imagesLoaded(function(){u.discardActiveObject(),c=u.width,d=u.height,p=0,m="left",h="top",f=1,g=1,ee(),te(u),ae(),u.requestRenderAll(),setTimeout(function(){u.fire("palleon:history",{type:"BG",text:palleonParams.resized})},500)})}()}),n.find("#palleon-resize-width").bind("input paste",function(){if(n.find("#palleon-resize-lock").hasClass("active")){var a=e(this).data("size")/n.find("#palleon-resize-height").data("size");n.find("#palleon-resize-height").val(Math.round(this.value/a))}}),n.find("#palleon-resize-height").bind("input paste",function(){if(n.find("#palleon-resize-lock").hasClass("active")){var a=e(this).data("size")/n.find("#palleon-resize-width").data("size");n.find("#palleon-resize-width").val(Math.round(this.value/a))}}),n.find("#palleon-rotate-right").on("click",function(){ie("right")}),n.find("#palleon-rotate-left").on("click",function(){ie("left")}),n.find("#palleon-flip-horizontal").on("click",function(){u.backgroundImage.toggle("flipX");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:re()[0],height:re()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});u.add(e),u.discardActiveObject();var a=new fabric.ActiveSelection(u.getObjects(),{canvas:u});u.setActiveObject(a);var t=u.getActiveObject();0==p||180==p||-180==p?t.toggle("flipX"):t.toggle("flipY"),u.remove(e),u.discardActiveObject(),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),n.find("#palleon-flip-vertical").on("click",function(){u.backgroundImage.toggle("flipY");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:re()[0],height:re()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});u.add(e),u.discardActiveObject();var a=new fabric.ActiveSelection(u.getObjects(),{canvas:u});u.setActiveObject(a);var t=u.getActiveObject();0==p||180==p||-180==p?t.toggle("flipY"):t.toggle("flipX"),u.remove(e),u.discardActiveObject(),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),n.find("#palleon-brightness").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Brightness):(n.find("#brightness").val(0),n.find("#brightness").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Brightness"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#brightness").on("input",function(){u.backgroundImage.filters.filter(e=>"Brightness"==e.type).forEach(e=>e.brightness=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#brightness").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-contrast").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Contrast):(n.find("#contrast").val(0),n.find("#contrast").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Contrast"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#contrast").on("input",function(){u.backgroundImage.filters.filter(e=>"Contrast"==e.type).forEach(e=>e.contrast=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#contrast").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-saturation").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Saturation):(n.find("#saturation").val(0),n.find("#saturation").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Saturation"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#saturation").on("input",function(){u.backgroundImage.filters.filter(e=>"Saturation"==e.type).forEach(e=>e.saturation=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#saturation").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-hue").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.HueRotation):(n.find("#hue").val(0),n.find("#hue").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"HueRotation"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#hue").on("input",function(){u.backgroundImage.filters.filter(e=>"HueRotation"==e.type).forEach(e=>e.rotation=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#hue").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-filters input[type=checkbox]").on("change",function(a){e(this).is(":checked")?"grayscale"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Grayscale):"sepia"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Sepia):"blackwhite"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.BlackWhite):"brownie"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Brownie):"vintage"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Vintage):"kodachrome"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Kodachrome):"technicolor"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Technicolor):"polaroid"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Polaroid):"shift"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Shift):"invert"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Invert):"sharpen"==e(this).attr("id")?(n.find("#emboss").prop("checked",!1),n.find("#sobelX").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))):"emboss"==e(this).attr("id")?(n.find("#sharpen").prop("checked",!1),n.find("#sobelX").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))):"sobelX"==e(this).attr("id")?(n.find("#emboss").prop("checked",!1),n.find("#sharpen").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,0,1,-2,0,2,-1,0,1]}))):"sobelY"==e(this).attr("id")&&(n.find("#emboss").prop("checked",!1),n.find("#sharpen").prop("checked",!1),n.find("#sobelX").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,-2,-1,0,0,0,1,2,1]}))):"grayscale"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Grayscale"!=e.type):"sepia"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Sepia"!=e.type):"blackwhite"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"BlackWhite"!=e.type):"brownie"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Brownie"!=e.type):"vintage"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Vintage"!=e.type):"kodachrome"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Kodachrome"!=e.type):"technicolor"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Technicolor"!=e.type):"polaroid"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Polaroid"!=e.type):"shift"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Shift"!=e.type):"invert"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Invert"!=e.type):"sharpen"==e(this).attr("id")?(n.find("#emboss").prop("checked",!1),n.find("#sobelX").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"emboss"==e(this).attr("id")?(n.find("#sharpen").prop("checked",!1),n.find("#sobelX").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelX"==e(this).attr("id")?(n.find("#emboss").prop("checked",!1),n.find("#sharpen").prop("checked",!1),n.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelY"==e(this).attr("id")&&(n.find("#emboss").prop("checked",!1),n.find("#sharpen").prop("checked",!1),n.find("#sobelX").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)),u.backgroundImage.applyFilters(),u.requestRenderAll(),a.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-gamma").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Gamma):(n.find("#gamma-red").val(1),n.find("#gamma-red").parent().parent().find(".slider-label span").html(1),n.find("#gamma-green").val(1),n.find("#gamma-green").parent().parent().find(".slider-label span").html(1),n.find("#gamma-blue").val(1),n.find("#gamma-blue").parent().parent().find(".slider-label span").html(1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Gamma"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#palleon-gamma-settings input").on("input",function(){var a=[parseFloat(e("#gamma-red").val()),parseFloat(e("#gamma-green").val()),parseFloat(e("#gamma-blue").val())];u.backgroundImage.filters.filter(e=>"Gamma"==e.type).forEach(e=>e.gamma=a),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#palleon-gamma-settings input").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-blur").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Blur):(n.find("#blur").val(0),n.find("#blur").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Blur"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#blur").on("change",function(e){u.backgroundImage.filters.filter(e=>"Blur"==e.type).forEach(e=>e.blur=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll(),e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-noise").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Noise):(n.find("#noise").val(0),n.find("#noise").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Noise"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#noise").on("input",function(){u.backgroundImage.filters.filter(e=>"Noise"==e.type).forEach(e=>e.noise=parseInt(this.value,10)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#noise").on("change",function(e){e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-pixelate").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Pixelate):(n.find("#pixelate").val(1),n.find("#pixelate").parent().parent().find(".slider-label span").html(1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Pixelate"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),n.find("#pixelate").on("change",function(e){u.backgroundImage.filters.filter(e=>"Pixelate"==e.type).forEach(e=>e.blocksize=parseInt(this.value,10)),u.backgroundImage.applyFilters(),u.requestRenderAll(),e.originalEvent&&Z(palleonParams.bg+" "+palleonParams.edited)}),n.find("#palleon-blend-color").on("change",function(){if(e(this).is(":checked")){var a=n.find("#blend-color-mode").val(),t=n.find("#blend-color-color").val(),l=parseFloat(n.find("#blend-color-alpha").val());u.backgroundImage.filters.push(new fabric.Image.filters.BlendColor),u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=a,e=>e.color=t,e=>e.alpha=parseFloat(l))}else n.find("#blend-color-mode").val("add"),n.find("#blend-color-color").spectrum("set","#ffffff"),n.find("#blend-color-alpha").val(.5),n.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"BlendColor"!=e.type);u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#blend-color-mode").on("change",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=this.value),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#blend-color-color").on("change",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.color=this.value),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#blend-color-alpha").on("input",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.alpha=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#palleon-duotone-color").on("change",function(){e(this).is(":checked")?(k=new fabric.Image.filters.Composed({subFilters:[new fabric.Image.filters.Grayscale({mode:"luminosity"}),new fabric.Image.filters.BlendColor({color:n.find("#duotone-light-color").val()}),new fabric.Image.filters.BlendColor({color:n.find("#duotone-dark-color").val(),mode:"lighten"})]}),u.backgroundImage.filters.push(k)):(n.find("#duotone-light-color").spectrum("set","green"),n.find("#duotone-dark-color").spectrum("set","blue"),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#duotone-light-color").on("change",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type),u.backgroundImage.filters.push(k),k.subFilters[1].color=e(this).val(),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#duotone-dark-color").on("change",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type),u.backgroundImage.filters.push(k),k.subFilters[2].color=e(this).val(),u.backgroundImage.applyFilters(),u.requestRenderAll()}),n.find("#palleon-swap-apply").on("click",function(){var a=new fabric.Image.filters.SwapColor({colorSource:n.find("#color-source").val(),colorDestination:n.find("#color-destination").val()});u.backgroundImage.filters.push(a),u.backgroundImage.applyFilters(),u.requestRenderAll(),e(this).prop("disabled",!0),n.find("#palleon-swap-remove").prop("disabled",!1)}),n.find("#palleon-swap-remove").on("click",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"SwapColor"!=e.type),u.backgroundImage.applyFilters(),u.requestRenderAll(),e(this).prop("disabled",!0),n.find("#palleon-swap-apply").prop("disabled",!1)}),n.find("#palleon-swap-colors").on("change",function(){e(this).is(":checked")||n.find("#palleon-swap-remove").trigger("click")});function oe(e){var a=u.getActiveObject();a.set("gradientFill",n.find("#palleon-"+e+"-gradient").val());var t="";if(""==n.find("#"+e+"-gradient-color-3").val()&&""==n.find("#"+e+"-gradient-color-4").val()?t=[{offset:0,color:n.find("#"+e+"-gradient-color-1").val()},{offset:1,color:n.find("#"+e+"-gradient-color-2").val()}]:""!=n.find("#"+e+"-gradient-color-3").val()&&""==n.find("#"+e+"-gradient-color-4").val()?t=[{offset:0,color:n.find("#"+e+"-gradient-color-1").val()},{offset:.5,color:n.find("#"+e+"-gradient-color-2").val()},{offset:1,color:n.find("#"+e+"-gradient-color-3").val()}]:""!=n.find("#"+e+"-gradient-color-1").val()&&""!=n.find("#"+e+"-gradient-color-2").val()&&""!=n.find("#"+e+"-gradient-color-3").val()&&""!=n.find("#"+e+"-gradient-color-4").val()&&(t=[{offset:0,color:n.find("#"+e+"-gradient-color-1").val()},{offset:.25,color:n.find("#"+e+"-gradient-color-2").val()},{offset:.75,color:n.find("#"+e+"-gradient-color-3").val()},{offset:1,color:n.find("#"+e+"-gradient-color-4").val()}]),"vertical"==n.find("#palleon-"+e+"-gradient").val()){if(n.find("#"+e+"-gradient-settings").show(),n.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:t})),"element"==a.objectType&&a._objects)for(var l=0;l<a._objects.length;l++)""!=a._objects[l].fill&&a._objects[l].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:t})})}else if("horizontal"==n.find("#palleon-"+e+"-gradient").val()){if(n.find("#"+e+"-gradient-settings").show(),n.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:t})),"element"==a.objectType&&a._objects)for(l=0;l<a._objects.length;l++)""!=a._objects[l].fill&&a._objects[l].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:t})})}else if(n.find("#"+e+"-gradient-settings").hide(),n.find("#"+e+"-fill-color").show(),a.set("fill",n.find("#palleon-"+e+"-color").val()),"element"==a.objectType&&a._objects)for(l=0;l<a._objects.length;l++)""!=a._objects[l].fill&&a._objects[l].set("fill",n.find("#palleon-"+e+"-color").val());u.requestRenderAll()}e.each(["text","image","shape","element"],function(a,t){n.find("#palleon-"+t+"-shadow").on("change",function(){var a=new fabric.Shadow({color:n.find("#"+t+"-shadow-color").val(),blur:n.find("#"+t+"-shadow-blur").val(),offsetX:n.find("#"+t+"-shadow-offset-x").val(),offsetY:n.find("#"+t+"-shadow-offset-y").val()});e(this).is(":checked")?u.getActiveObject().shadow=a:u.getActiveObject().shadow=null,u.requestRenderAll()}),n.find("#"+t+"-shadow-color").bind("change",function(){u.getActiveObject().shadow.color=e(this).val(),u.requestRenderAll()}),n.find("#"+t+"-shadow-settings input[type=number]").bind("input paste keyup keydown",function(){var a=e(this).val();e(this).attr("id")==t+"-shadow-blur"?u.getActiveObject().shadow.blur=parseInt(a):e(this).attr("id")==t+"-shadow-offset-x"?u.getActiveObject().shadow.offsetX=parseInt(a):e(this).attr("id")==t+"-shadow-offset-y"&&(u.getActiveObject().shadow.offsetY=parseInt(a)),u.requestRenderAll()})});function re(){var e=u.backgroundImage.getScaledHeight(),a=u.backgroundImage.getScaledWidth();return 0!=p&&180!=p&&-180!=p||(e=u.backgroundImage.getScaledWidth(),a=u.backgroundImage.getScaledHeight()),[e,a]}e.each(["text","shape","element"],function(e,a){n.find("#palleon-"+a+"-gradient").on("change",function(){oe(a)}),n.find("#"+a+"-gradient-color-1").on("change",function(){oe(a)}),n.find("#"+a+"-gradient-color-2").on("change",function(){oe(a)}),n.find("#"+a+"-gradient-color-3").on("change",function(){oe(a)}),n.find("#"+a+"-gradient-color-4").on("change",function(){oe(a)})}),n.find("#palleon-add-text").on("click",function(){var e=u.getObjects().filter(e=>"printarea"==e.objectType)[0],a="";if(e){var t=Math.floor(e.width/14);a=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:t,fontFamily:i.fontFamily,fontWeight:i.fontWeight,fontStyle:i.fontStyle,lineHeight:i.lineHeight,fill:i.fill,stroke:i.stroke,strokeWidth:i.strokeWidth,textBackgroundColor:i.textBackgroundColor,textAlign:i.textAlign,width:.8*e.width,top:e.top,left:e.left,originX:"center",originY:"center"})}else a=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontWeight:i.fontWeight,fontStyle:i.fontStyle,lineHeight:i.lineHeight,fill:i.fill,stroke:i.stroke,strokeWidth:i.strokeWidth,textBackgroundColor:i.textBackgroundColor,textAlign:i.textAlign,width:re()[0]/2,top:re()[1]/2,left:re()[0]/2,originX:"center",originY:"center"});u.add(a),u.setActiveObject(a),u.fire("palleon:history",{type:"textbox",text:palleonParams.added})}),n.find("#palleon-text-input").bind("input paste",function(){u.getActiveObject().set("text",e(this).val()),n.find("#palleon-layers #"+u.getActiveObject().id+" .layer-name").html(u.getActiveObject().text),u.requestRenderAll()}),n.find("#palleon-text-input").bind("focusout",function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),n.find("#palleon-font-family").on("change",function(){for(var a=e(this).val(),t="yes",n=0;n<I.length;n++)if(I[n][1]==a){t="no";break}if("yes"==t){"undefined"==typeof palleonCustomFonts?WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}}):palleonCustomFonts.fonts.includes(a)||WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}});var l=new FontFaceObserver(a,{weight:"normal",style:"normal"}),i=new FontFaceObserver(a,{weight:"bold",style:"normal"}),o=new FontFaceObserver(a,{weight:"normal",style:"italic"}),r=new FontFaceObserver(a,{weight:"bold",style:"italic"});Promise.all([l.load(null,5e3),i.load(null,5e3),o.load(null,5e3),r.load(null,5e3)]).then(function(){u.getActiveObject().set("fontFamily",a),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}).catch(function(e){console.log(e)})}else u.getActiveObject().set("fontFamily",a),u.requestRenderAll()});var se=[],ce=0;function de(a){var t=a.element;return e(t).data("icon")?e('<div class="select2-item"><span class="material-icons">'+e(t).data("icon")+"</span>"+a.text+"</div>"):e(t).data("font")?e('<div class="select2-item" style="font-family:'+e(t).data("font")+'">'+a.text+"</div>"):e('<div class="select2-item">'+a.text+"</div>")}n.find("#palleon-font-family").on("select2:open",function(){n.find("#select2-palleon-font-family-results").scroll(function(){e(this).find("li:last-child").find("ul li").each(function(){var a=e(this);a.is(":in-viewport( 0, #select2-palleon-font-family-results)")&&(se.includes(a.attr("id"))||(WebFont.load({google:{families:[a.find(".select2-item").html()]},inactive:function(){WebFont.load({custom:{families:[a.find(".select2-item").html()],urls:["https://fonts.googleapis.com/css?family="+a.find(".select2-item").html()+"&text=abc"]},active:function(){console.log("active")}})}}),se.push(a.attr("id"))))})}),n.on("keypress",".select2-search .select2-search__field",function(e){window.clearTimeout(ce),ce=setTimeout(function(){n.find("#select2-palleon-font-family-results").trigger("scroll")},500)})}),n.find("#palleon-text-format-btns > .palleon-btn").on("click",function(){if("format-uppercase"==e(this).attr("id")){var a=n.find("#palleon-text-input").val();a=a===a.toUpperCase()?a.toLowerCase():a.toUpperCase(),n.find("#palleon-text-input").val(a),n.find("#palleon-text-input").trigger("input")}e(this).hasClass("active")?("format-bold"==e(this).attr("id")&&(u.getActiveObject().set("fontWeight","normal"),e(this).removeClass("active")),"format-italic"==e(this).attr("id")&&(u.getActiveObject().set("fontStyle","normal"),e(this).removeClass("active")),"format-underlined"==e(this).attr("id")&&(u.getActiveObject().set("underline",!1),e(this).removeClass("active"))):("format-bold"==e(this).attr("id")&&u.getActiveObject().set("fontWeight","bold"),"format-italic"==e(this).attr("id")&&u.getActiveObject().set("fontStyle","italic"),"format-underlined"==e(this).attr("id")&&u.getActiveObject().set("underline",!0),"format-align-left"==e(this).attr("id")&&u.getActiveObject().set("textAlign","left"),"format-align-right"==e(this).attr("id")&&u.getActiveObject().set("textAlign","right"),"format-align-center"==e(this).attr("id")&&u.getActiveObject().set("textAlign","center"),"format-align-justify"==e(this).attr("id")&&u.getActiveObject().set("textAlign","justify"),n.find(".format-align").removeClass("active"),"format-uppercase"!=e(this).attr("id")&&e(this).addClass("active")),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),n.find("#palleon-text-settings input[type=number]").bind("input paste keyup keydown",function(){var a=e(this).val();"palleon-font-size"==e(this).attr("id")?u.getActiveObject().set("fontSize",parseInt(a)):"palleon-outline-size"==e(this).attr("id")?u.getActiveObject().set("strokeWidth",parseInt(a)):"palleon-line-height"==e(this).attr("id")?u.getActiveObject().set("lineHeight",parseFloat(a)):"palleon-letter-spacing"==e(this).attr("id")&&u.getActiveObject().set("charSpacing",parseInt(a)),u.requestRenderAll()}),n.find("#palleon-text-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})},500)}),n.find("#palleon-text-settings .palleon-colorpicker").bind("change",function(){var a=e(this).val();"palleon-text-color"==e(this).attr("id")?u.getActiveObject().set("fill",a):"palleon-outline-color"==e(this).attr("id")?u.getActiveObject().set("stroke",a):"palleon-text-background"==e(this).attr("id")&&u.getActiveObject().set("textBackgroundColor",a),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),n.find("#palleon-text-flip-btns > .palleon-btn").on("click",function(){e(this).hasClass("active")?("text-flip-x"==e(this).attr("id")?u.getActiveObject().set("flipX",!1):"text-flip-y"==e(this).attr("id")&&u.getActiveObject().set("flipY",!1),e(this).removeClass("active")):("text-flip-x"==e(this).attr("id")?u.getActiveObject().set("flipX",!0):"text-flip-y"==e(this).attr("id")&&u.getActiveObject().set("flipY",!0),e(this).addClass("active")),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),n.find("#palleon-text-settings input[type=range]").bind("input click",function(){var a=e(this).val();"text-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"text-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"text-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"text-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),n.find("#palleon-text-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),n.find("#palleon-img-upload").on("change",function(a){if(""!=e(this).val()){if(e(this).data("max")&&""!=e(this).data("max")&&this.files[0].size>parseInt(e(this).data("max")))return toastr.error(palleonParams.maxUploadSize+" "+parseInt(e(this).data("max"))/1048576+"MB.",palleonParams.error),void(this.value="");var t=re()[1]/2,n=re()[0]/2,l=u.getObjects().filter(e=>"printarea"==e.objectType)[0];l&&(t=l.top,n=l.left);var i=new FileReader;i.onload=function(e){var a=new Image;F(e.target.result,function(e){a.src=e,a.onload=function(){var e=new fabric.Image(a);e.set({objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:t,left:n,originX:"center",originY:"center"}),u.add(e),l?(e.scaleToWidth(.8*l.width*u.getZoom()),e.isContainedWithinObject(l)||e.scaleToHeight(.8*l.height*u.getZoom())):(e.scaleToWidth(re()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(re()[1]/4)),u.setActiveObject(e),u.requestRenderAll()}})},i.readAsDataURL(a.target.files[0]),u.fire("palleon:history",{type:"image",text:palleonParams.added})}}),n.find("#palleon-overlay-img-upload").on("change",function(a){if(""!=e(this).val()){n.find("#palleon-canvas-loader").css("display","flex");var t=new FileReader;t.onload=function(e){var a=new Image;F(e.target.result,function(t){a.src=t,a.onload=function(){var t=new fabric.Image(a);t.set({scaleX:re()[0]/t.width,scaleY:re()[1]/t.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),u.setOverlayImage(t,u.renderAll.bind(u)),n.find("#palleon-overlay-wrap").show(),n.find("#palleon-overlay-preview").attr("src",e.target.result),setTimeout(function(){n.find("#palleon-canvas-loader").hide()},500)}})},t.readAsDataURL(a.target.files[0]),u.fire("palleon:history",{type:"image",text:palleonParams.added})}}),n.find("#palleon-overlay-delete").on("click",function(){void 0!==u.overlayImage&&null!==u.overlayImage&&(u.overlayImage=null,n.find("#palleon-overlay-wrap").hide(),n.find("#palleon-overlay-preview").attr("src",""),u.requestRenderAll())}),n.find("#img-flip-horizontal").on("click",function(){u.getActiveObject().toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),n.find("#img-flip-vertical").on("click",function(){u.getActiveObject().toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})});n.find("#img-border-radius").on("input",function(){u.getActiveObject().set("clipPath",((e,a)=>new fabric.Rect({width:e.width,height:e.height,rx:a/e.scaleX,ry:a/e.scaleY,left:-e.width/2,top:-e.height/2}))(u.getActiveObject(),parseInt(e(this).val()))),u.getActiveObject().set("roundedCorders",parseInt(e(this).val())),u.requestRenderAll()}),n.find("#img-border-radius").bind("change",function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),n.find("#img-border-color").bind("change",function(){u.getActiveObject().set("stroke",e(this).val()),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),n.find("#palleon-image-settings input[type=number]").on("input paste",function(){var a=parseInt(e(this).val());"img-border-width"==e(this).attr("id")&&u.getActiveObject().set("strokeWidth",a),u.requestRenderAll()}),n.find("#palleon-image-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})},500)}),n.find("#palleon-image-settings input[type=range]").bind("input click",function(){var a=e(this).val();"img-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"img-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"img-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"img-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),n.find("#palleon-image-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),n.find("#palleon-shape-select").on("change",function(){var a=e(this).val();"none"==a||"custom"==a?n.find("#palleon-shape-add").prop("disabled",!0):n.find("#palleon-shape-add").prop("disabled",!1)}),n.find("#palleon-shape-add").on("click",function(){var e=n.find("#palleon-shape-select").val();"printarea"==e&&(u.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),n.find("#palleon-layers li").remove());var a=re()[1]/2,t=re()[0]/2,l=u.getObjects().filter(e=>"printarea"==e.objectType)[0];l&&(a=l.top,t=l.left);var i="",o="";"circle"==e?(i=new fabric.Circle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"circle",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"ellipse"==e?i=new fabric.Ellipse({rx:75,ry:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"ellipse",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"}):"square"==e?(i=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"square",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"rectangle"==e?i=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"rectangle",width:200,height:150,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"}):"triangle"==e?i=new fabric.Triangle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"triangle",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"}):"trapezoid"==e?(o=[{x:-100,y:-50},{x:100,y:-50},{x:150,y:50},{x:-150,y:50}],i=new fabric.Polygon(o,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"trapezoid",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})):"pentagon"==e?(o=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}],i=new fabric.Polygon(o,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"pentagon",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})):"octagon"==e?(o=[{x:34.2,y:87.4},{x:12.3,y:65.5},{x:12.3,y:34.5},{x:34.2,y:12.6},{x:65.2,y:12.6},{x:87.1,y:34.5},{x:87.1,y:65.5},{x:65.2,y:87.4}],i=new fabric.Polygon(o,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"octagon",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})):"emerald"==e?(o=[{x:850,y:75},{x:958,y:137.5},{x:958,y:262.5},{x:850,y:325},{x:742,y:262.5},{x:742,y:137.5}],i=new fabric.Polygon(o,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"emerald",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})):"star"==e?(o=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],i=new fabric.Polygon(o,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"star",width:100,height:100,gradientFill:"none",top:a,left:t,originX:"center",originY:"center"})):"printarea"==e&&((i=new fabric.Rect({radius:50,fill:"",stroke:"#4affff",strokeWidth:3,strokeDashArray:[10,5],objectType:"printarea",width:c/2,height:d/2,gradientFill:"none",top:a,left:t,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})}),u.add(i),l?(i.scaleToWidth(.5*l.width*u.getZoom()),i.isContainedWithinObject(l)||i.scaleToHeight(.5*l.height*u.getZoom())):"printarea"!=i.objectType&&(i.scaleToWidth(re()[0]/6),i.isPartiallyOnScreen()&&i.scaleToHeight(re()[1]/6)),u.setActiveObject(i),u.requestRenderAll(),u.fire("palleon:history",{type:e,text:palleonParams.added})}),n.find("#palleon-shape-settings .palleon-colorpicker").bind("change",function(){var a=e(this).val();"palleon-shape-color"==e(this).attr("id")?u.getActiveObject().set("fill",a):"shape-outline-color"==e(this).attr("id")&&u.getActiveObject().set("stroke",a),u.requestRenderAll(),u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})}),n.find("#palleon-shape-settings input[type=range]").bind("input click",function(){var a=e(this).val();"shape-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"shape-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"shape-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"shape-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),n.find("#palleon-shape-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})}),n.find("#palleon-shape-settings input[type=number]").bind("input paste",function(){var a=parseInt(e(this).val());"shape-outline-width"==e(this).attr("id")?u.getActiveObject().set("strokeWidth",a):"shape-custom-width"==e(this).attr("id")?(u.getActiveObject().set("width",a),u.getActiveObject().set("scaleX",1)):"shape-custom-height"==e(this).attr("id")&&(u.getActiveObject().set("height",a),u.getActiveObject().set("scaleY",1)),u.requestRenderAll()}),n.find("#palleon-shape-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})},500)}),n.find("#shape-custom-width").bind("input paste",function(){if(n.find("#palleon-shape-ratio-lock").hasClass("active")){var a=parseInt(e(this).val()),t=parseInt(n.find("#palleon-shape-ratio-w").val()),l=a*parseInt(n.find("#palleon-shape-ratio-h").val())/t;n.find("#shape-custom-height").val(Math.round(l)),u.getActiveObject().set("height",l),u.getActiveObject().set("scaleY",1)}}),n.find("#shape-custom-height").bind("input paste",function(){if(n.find("#palleon-shape-ratio-lock").hasClass("active")){var a=e(this).val()*parseInt(n.find("#palleon-shape-ratio-w").val())/parseInt(n.find("#palleon-shape-ratio-h").val());n.find("#shape-custom-width").val(Math.round(a)),u.getActiveObject().set("width",a),u.getActiveObject().set("scaleX",1)}});function pe(a){var t=u.getObjects().filter(e=>"frame"==e.objectType),n=u.getObjects().filter(e=>"printarea"==e.objectType)[0];e.each(t,function(e,t){var l=t.angle,i=t.width,o=t.height,r=re()[1]/2,s=re()[0]/2,c=re()[0],d=re()[1];0!=l&&180!=l&&-180!=l||(c=re()[1],d=re()[0]),n&&(r=n.top,s=n.left,c=n.width,d=n.height,0!=l&&180!=l&&-180!=l||(c=n.height,d=n.width)),"right"==a?0==l?l=90:90==l?l=180:180==l?l=270:270==l?l=0:-90==l?l=0:-180==l?l=-90:-270==l&&(l=-180):"left"==a&&(0==l?l=-90:-90==l?l=-180:-180==l?l=-270:-270==l?l=0:90==l?l=0:180==l?l=90:270==l&&(l=180)),t.set("left",s),t.set("top",r),t.set("scaleX",c/i),t.set("scaleY",d/o),t.set("angle",l)}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}n.find("#palleon-frame-search").on("keyup input",function(){n.find("#palleon-noframes").hide();var a=e(this).val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(n.find("#palleon-frames-wrap li").show(),n.find("#palleon-frame-search-icon").html("search"),n.find("#palleon-frame-search-icon").removeClass("cancel")):(n.find("#palleon-frame-search-icon").html("clear"),n.find("#palleon-frame-search-icon").addClass("cancel"),function(e){n.find("#palleon-frames-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()}(a),0===n.find("#palleon-frames-wrap li:visible").length&&n.find("#palleon-noframes").show())}),n.find("#palleon-frame-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),n.find("#palleon-frame-search").val(""),n.find("#palleon-frames-wrap li").show(),n.find("#palleon-noframes").hide())}),n.find(".palleon-frames-grid").on("click",".palleon-frame img",function(){n.find("#palleon-canvas-loader").css("display","flex");var a=e(this).parent().parent(),t=a.data("elsource");n.find(".palleon-frames-grid .palleon-frame").removeClass("active"),a.addClass("active"),fabric.loadSVGFromURL(t,function(e,a){var t=re()[1]/2,l=re()[0]/2,i=re()[0]+2,o=re()[1]+2,r=u.getObjects().filter(e=>"printarea"==e.objectType)[0];r&&(t=r.top,l=r.left,i=r.width,o=r.height);var s=fabric.util.groupSVGElements(e,a),c=s.width,d=s.height;s.set("originX","center"),s.set("originY","center"),s.set("left",l),s.set("top",t),s.set("scaleX",i/c),s.set("scaleY",o/d),s.set("objectType","frame"),u.add(s),u.setActiveObject(s),r&&n.find("#palleon-layers #"+s.id).find("a.lock-layer").trigger("click"),u.requestRenderAll(),n.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),u.fire("palleon:history",{type:"frame",text:palleonParams.added})}),n.find(".palleon-frames-grid").on("click",".frame-favorite button.star",function(){var a=e(this),t=a.data("frameid"),l="add";a.hasClass("favorited")?(n.find('*[data-frameid="'+t+'"]').removeClass("favorited"),l="remove"):n.find('*[data-frameid="'+t+'"]').addClass("favorited");var i={action:"favframe",nonce:palleonParams.nonce,frameid:t,mode:l};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==l?(n.find('*[data-frameid="'+t+'"]').html('<span class="material-icons">star</span>'),toastr.success(palleonParams.favorited,palleonParams.success)):(n.find('*[data-frameid="'+t+'"]').html('<span class="material-icons">star_border</span>'),toastr.success(palleonParams.unfavorited,palleonParams.success)),e&&(n.find("#palleon-frame-favorites > div").html(e),S.update())},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#palleon-frame-color").bind("change",function(){var a=e(this).val(),t=u.getObjects().filter(e=>"frame"==e.objectType);e.each(t,function(e,t){if(""!=t.fill&&t.set("fill",a),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set({fill:a})}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),n.find("#palleon-rotate-right-frame").on("click",function(){pe("right")}),n.find("#palleon-rotate-left-frame").on("click",function(){pe("left")}),n.find("#palleon-flip-horizontal-frame").on("click",function(){var a=u.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){a.toggle("flipX")}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),n.find("#palleon-flip-vertical-frame").on("click",function(){var a=u.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){a.toggle("flipY")}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})});n.find("#palleon-element-search").on("keyup input",function(){n.find("#palleon-noelements").hide();var a=e(this).val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(n.find("#palleon-elements-wrap li").show(),n.find("#palleon-element-search-icon").html("search"),n.find("#palleon-element-search-icon").removeClass("cancel")):(n.find("#palleon-element-search-icon").html("clear"),n.find("#palleon-element-search-icon").addClass("cancel"),function(e){n.find("#palleon-elements-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()}(a),0===n.find("#palleon-elements-wrap li:visible").length&&n.find("#palleon-noelements").show())}),n.find("#palleon-element-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),n.find("#palleon-element-search").val(""),n.find("#palleon-elements-wrap li").show(),n.find("#palleon-noelements").hide())}),n.find(".palleon-elements-grid").on("click",".palleon-element > *:first-child",function(){var a=re()[1]/2,t=re()[0]/2,l=u.getObjects().filter(e=>"printarea"==e.objectType)[0];l&&(a=l.top,t=l.left);var i=e(this).parent(),o=i.data("elsource");if("palleon-icons-grid"==i.parent().attr("id")){var r=n.find("#palleon-icon-style").val();o=i.data("elsource")+"/"+r+"/24px.svg"}var s=i.data("loader");"yes"==s&&n.find("#palleon-canvas-loader").css("display","flex"),n.find(".palleon-elements-grid .palleon-element").removeClass("active"),i.addClass("active"),fabric.loadSVGFromURL(o,function(e,i){var o=fabric.util.groupSVGElements(e,i);o.set("originX","center"),o.set("originY","center"),o.set("left",t),o.set("top",a),o.set("objectType","element"),o.set("gradientFill","none"),u.add(o),l?(o.scaleToWidth(.5*l.width*u.getZoom()),o.isContainedWithinObject(l)||o.scaleToHeight(.5*l.height*u.getZoom())):(o.scaleToWidth(re()[0]/8),o.isPartiallyOnScreen()&&o.scaleToHeight(re()[1]/8)),u.setActiveObject(o),u.requestRenderAll(),"yes"==s&&n.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),u.fire("palleon:history",{type:"element",text:palleonParams.added})}),n.find("#palleon-element-upload").on("change",function(e){var a=new FileReader,t="";a.onload=function(e){t=a.result,fabric.loadSVGFromURL(t,function(e,a){var t=fabric.util.groupSVGElements(e,a),n=u.getObjects().filter(e=>"printarea"==e.objectType)[0];t.set("originX","center"),t.set("originY","center"),t.set("left",re()[0]/2),t.set("top",re()[1]/2),t.set("objectType","customSVG"),u.add(t),n?(t.scaleToWidth(.8*n.width*u.getZoom()),t.isContainedWithinObject(n)||t.scaleToHeight(.8*n.height*u.getZoom())):(t.scaleToWidth(re()[0]/2),t.isPartiallyOnScreen()&&t.scaleToHeight(re()[1]/2)),u.setActiveObject(t),u.requestRenderAll()},function(){},{crossOrigin:"anonymous"})},a.readAsDataURL(this.files[0]),u.fire("palleon:history",{type:"element",text:palleonParams.added})}),n.find("#palleon-element-color").bind("change",function(){var a=e(this).val(),t=u.getActiveObject();if(""!=t.fill&&t.set("fill",a),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set({fill:a});u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),n.find("#element-flip-horizontal").on("click",function(){u.getActiveObject().toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),n.find("#element-flip-vertical").on("click",function(){u.getActiveObject().toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),n.find("#palleon-custom-element-options input[type=range]").bind("input click",function(){var a=e(this).val();"element-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"element-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"element-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"element-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),n.find("#palleon-custom-element-options input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),n.find(".palleon-grid").on("click",".element-favorite button.star",function(){var a=e(this),t=a.data("elementid"),l="add";a.hasClass("favorited")?(n.find('*[data-elementid="'+t+'"]').removeClass("favorited"),l="remove"):n.find('*[data-elementid="'+t+'"]').addClass("favorited");var i={action:"favElement",nonce:palleonParams.nonce,elementid:t,mode:l};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==l?(toastr.success(palleonParams.favorited,palleonParams.success),n.find('*[data-elementid="'+t+'"]').html('<span class="material-icons">star</span>')):(toastr.success(palleonParams.unfavorited,palleonParams.success),n.find('*[data-elementid="'+t+'"]').html('<span class="material-icons">star_border</span>')),e&&(n.find("#palleon-my-favorites > div").html(e),S.update())},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),n.find("#customsvg-flip-horizontal").on("click",function(){u.getActiveObject().toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),n.find("#customsvg-flip-vertical").on("click",function(){u.getActiveObject().toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),n.find("#palleon-custom-svg-options input[type=range]").bind("input click",function(){var a=e(this).val();"customsvg-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"customsvg-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"customsvg-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"customsvg-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),n.find("#palleon-custom-svg-options input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})});function fe(a,t){e("#tm-cursor-1").remove(),n.find("#palleon-canvas-wrap").tmpointer({id:1,native_cursor:"enable",cursorSize:a,cursorColor:t})}n.find("#palleon-icon-search").on("keyup input",function(){n.find("#palleon-noicons").hide();var a=e(this).val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(n.find("#palleon-icons-grid .palleon-element").css("display","flex"),n.find("#palleon-icon-search-icon").html("search"),n.find("#palleon-icon-search-icon").removeClass("cancel")):(n.find("#palleon-icon-search-icon").html("clear"),n.find("#palleon-icon-search-icon").addClass("cancel"),function(e){n.find("#palleon-icons-grid .palleon-element").css("display","none").filter('[title*="'+e+'"]').css("display","flex")}(a),0===n.find("#palleon-icons-grid .palleon-element:visible").length&&n.find("#palleon-noicons").show())}),n.find("#palleon-icon-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),n.find("#palleon-icon-search").val(""),n.find("#palleon-icons-grid .palleon-element").css("display","flex"),n.find("#palleon-noicons").hide())}),n.find("#palleon-generate-qr-code").on("click",function(){var e=kjua({text:n.find("#palleon-qrcode-text").val(),render:"svg",size:n.find("#palleon-qrcode-size").val(),fill:n.find("#palleon-qrcode-fill").val(),back:n.find("#palleon-qrcode-back").val(),rounded:n.find("#palleon-qrcode-rounded").val(),mode:"label",label:n.find("#palleon-qrcode-label").val(),fontname:"sans",fontcolor:n.find("#palleon-qrcode-label-color").val(),mSize:n.find("#palleon-qrcode-label-size").val(),mPosX:n.find("#palleon-qrcode-label-position-x").val(),mPosY:n.find("#palleon-qrcode-label-position-y").val()}),a=re()[1]/2,t=re()[0]/2,l=u.getObjects().filter(e=>"printarea"==e.objectType)[0];l&&(a=l.top,t=l.left);var i=(new XMLSerializer).serializeToString(e);fabric.loadSVGFromString(i,function(e,n){var i=fabric.util.groupSVGElements(e,n);i.set("originX","center"),i.set("originY","center"),i.set("left",t),i.set("top",a),i.set("objectType","qrCode"),i.set("gradientFill","none"),i.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},u.add(i),l?(i.scaleToWidth(.5*l.width*u.getZoom()),i.isContainedWithinObject(l)||i.scaleToHeight(.5*l.height*u.getZoom())):(i.scaleToWidth(re()[0]/8),i.isPartiallyOnScreen()&&i.scaleToHeight(re()[1]/8)),u.setActiveObject(i),u.requestRenderAll()})}),n.find("#palleon-draw-btn").on("click",function(){e(this).hasClass("active")?(n.find("#palleon-draw-undo").prop("disabled",!0),e("#tm-cursor-1").remove(),n.find("#palleon-draw-settings").hide(),n.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right").css("pointer-events","auto"),e(this).removeClass("active"),u.isDrawingMode=!1,e(this).html('<span class="material-icons">edit</span>Start Drawing')):(n.find("#palleon-draw-undo").prop("disabled",!1),n.find("#palleon-draw-settings").show(),n.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right").css("pointer-events","none"),e(this).addClass("active"),n.find("#palleon-brush-select").trigger("change"),u.isDrawingMode=!0,e(this).html('<span class="material-icons">close</span>Stop Drawing'))}),n.find("#palleon-brush-select").on("change",function(){var a=e(this).val();if("pencil"==a){var t=new fabric.PencilBrush(u);u.freeDrawingBrush=t}else if("circle"==a){var l=new fabric.CircleBrush(u);u.freeDrawingBrush=l}else if("spray"==a){var i=new fabric.SprayBrush(u);u.freeDrawingBrush=i}else if("hline"==a){var o=new fabric.PatternBrush(u);u.freeDrawingBrush=o,o.getPatternSrc=function(){var e=parseInt(n.find("#brush-pattern-width").val()),a=e/2,t=fabric.document.createElement("canvas");t.width=t.height=e;var l=t.getContext("2d");return l.strokeStyle=n.find("#brush-color").val(),l.lineWidth=a,l.beginPath(),l.moveTo(a,0),l.lineTo(a,e),l.closePath(),l.stroke(),t}}else if("vline"==a){var r=new fabric.PatternBrush(u);u.freeDrawingBrush=r,r.getPatternSrc=function(){var e=parseInt(n.find("#brush-pattern-width").val()),a=e/2,t=fabric.document.createElement("canvas");t.width=t.height=e;var l=t.getContext("2d");return l.strokeStyle=n.find("#brush-color").val(),l.lineWidth=a,l.beginPath(),l.moveTo(0,a),l.lineTo(e,a),l.closePath(),l.stroke(),t}}else if("square"==a){var s=new fabric.PatternBrush(u);u.freeDrawingBrush=s,s.getPatternSrc=function(){var e=parseInt(n.find("#brush-pattern-width").val()),a=parseInt(n.find("#brush-pattern-distance").val()),t=fabric.document.createElement("canvas");t.width=t.height=e+a;var l=t.getContext("2d");return l.fillStyle=n.find("#brush-color").val(),l.fillRect(0,0,e,e),t}}else if("erase"==a){var c=new fabric.EraserBrush(u);u.freeDrawingBrush=c}(y=u.freeDrawingBrush).getPatternSrc&&(y.source=y.getPatternSrc.call(y)),y.width=parseInt(n.find("#brush-width").val()),"erase"==a?(n.find("#not-erase-brush").hide(),y.shadow=null,y.color="#E91E63"):(u.freeDrawingBrush.inverted=!1,n.find("#palleon-draw-undo").removeClass("active"),n.find("#not-erase-brush").show(),y.color=n.find("#brush-color").val()),n.find("#palleon-brush-shadow").is(":checked")?y.shadow=w:y.shadow=null,fe(y.width*u.getZoom(),y.color),"hline"==a||"vline"==a||"square"==a?n.find("#palleon-brush-pattern-width").css("display","flex"):n.find("#palleon-brush-pattern-width").css("display","none"),"square"==a?n.find("#palleon-brush-pattern-distance").css("display","flex"):n.find("#palleon-brush-pattern-distance").css("display","none")}),n.find("#palleon-brush-shadow").on("change",function(){w=new fabric.Shadow({color:n.find("#brush-shadow-color").val(),blur:n.find("#brush-shadow-width").val(),offsetX:n.find("#brush-shadow-shadow-offset-x").val(),offsetY:n.find("#brush-shadow-shadow-offset-y").val()}),e(this).is(":checked")?y.shadow=w:y.shadow=null}),n.find("#palleon-draw-settings input[type=number]").bind("input paste keyup keydown",function(){"brush-width"==e(this).attr("id")?(y.width=parseInt(e(this).val()),fe(y.width*u.getZoom(),y.color)):"brush-shadow-shadow-offset-x"==e(this).attr("id")?w.offsetX=parseInt(e(this).val()):"brush-shadow-shadow-offset-y"==e(this).attr("id")?w.offsetY=parseInt(e(this).val()):"brush-shadow-width"==e(this).attr("id")?w.blur=parseInt(e(this).val()):"brush-pattern-width"==e(this).attr("id")?n.find("#palleon-brush-select").trigger("change"):"brush-pattern-distance"==e(this).attr("id")&&n.find("#palleon-brush-select").trigger("change")}),n.find("#palleon-draw-settings .palleon-colorpicker").bind("change",function(){"brush-color"==e(this).attr("id")?(y.color=e(this).val(),fe(y.width*u.getZoom(),y.color),n.find("#palleon-brush-select").trigger("change")):"brush-shadow-color"==e(this).attr("id")&&(w.color=e(this).val())}),n.find("#palleon-draw-undo").on("click",function(){if("erase"==n.find("#palleon-brush-select").val())u.backgroundImage&&(e(this).hasClass("active")?(e(this).removeClass("active"),u.freeDrawingBrush.inverted=!1):(e(this).addClass("active"),u.freeDrawingBrush.inverted=!0));else{var a=u.getObjects().filter(e=>"drawing"==e.objectType).slice(-1)[0];u.remove(a),u.requestRenderAll()}}),document.onkeydown=function(e){var a=u.getActiveObject();switch(e.keyCode){case 38:a&&(a.top-=1,u.requestRenderAll());break;case 40:a&&(a.top+=1,u.requestRenderAll());break;case 37:a&&(a.left-=1,u.requestRenderAll());break;case 39:a&&(a.left+=1,u.requestRenderAll())}},n.find("#custom-theme").on("change",function(){var a=e(this).val(),t=palleonParams.baseURL+"css/"+a+palleonParams.suffix+".css";e("#palleon-theme-link").attr("href",t),n.removeClass("light-theme"),n.removeClass("dark-theme"),n.addClass(a+"-theme")}),n.find("#custom-font-size").on("input",function(){e("html").css("font-size",e(this).val()+"px")}),n.find("#custom-background").on("change",function(){var a=e(this).val();""!=a&&n.find("#palleon-content").css("background-color",a)}),n.find("#custom-image-background").on("change",function(){var a=e(this).val();n.find("#palleon-canvas-color").spectrum("set",a),""==a?(u.backgroundColor="transparent",u.requestRenderAll()):(u.backgroundColor=a,u.requestRenderAll())}),n.find("#ruler-guide-color").on("change",function(){var a=e(this).val();""!=a&&(n.find(".guide.h, .guide.v").css("border-color",a),initAligningGuidelines(u))}),n.find("#ruler-guide-size").on("input",function(){var a=e(this).val();n.find(".guide.h, .guide.v").css("border-width",a+"px"),initAligningGuidelines(u)}),n.find("#palleon-preferences-save").on("click",function(){var a=e(this),t={},l=[],i=[];n.find("#palleon-preferences .preference").each(function(a,t){l.push(e(this).attr("id")),i.push(e(this).val())});for(let e=0;e<l.length;e++)t[l[e]]=i[e];var o={action:"savePreferences",nonce:palleonParams.nonce,preferences:JSON.stringify(t)};e.ajax({url:palleonParams.ajaxurl,data:o,type:"POST",beforeSend:function(){a.prop("disabled",!0)},success:function(){toastr.success(palleonParams.settingsaved,palleonParams.success)},complete:function(){a.prop("disabled",!1)},error:function(e,a,t){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),initAligningGuidelines(u),e(window).on("resize",function(){ae()}),i.customFunctions.call(this,n,u,S,toastr)},new FontFaceObserver("Material Icons").load(null,1e4).then(function(){e("#palleon").find("#palleon-main-loader").fadeOut(200),setTimeout(function(){e("#palleon").find("#palleon-main-loader").remove()},300)}).catch(function(a){console.log(a),e("#palleon").find("#palleon-main-loader").remove()})}(jQuery);